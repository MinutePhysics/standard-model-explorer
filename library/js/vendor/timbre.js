(function(e){function j(){function r(e){var t=new Array(e.byteLength),n=e.BYTES_PER_ELEMENT,r;for(var i=0,s=t.length;i<s;++i)r=i%n*8,t[i]=(e[i/n|0]&255<<r)>>>r;return t.__view=e,t}function i(e,i,u,a){var f,l,c,h,p;if(Array.isArray(i))if(i.__view){typeof u=="undefined"&&(u=0),typeof a=="undefined"&&(a=i.length-u),c=e.bytes;if(e.type===n)f=i.__view.slice(u/c|0,(u+a)/c|0);else{l=i.slice(u,u+a),f=new Array(l.length/c|0);for(h=0,p=f.length;h<p;++h)f[h]=0;for(h=0,p=l.length;h<p;++h)f[h/c|0]+=(l[h]&255)<<h%c*8}}else f=i.slice();else typeof i=="number"&&i>0?f=new Array(i|0):f=[];if(e.type!==n)for(h=0,p=f.length;h<p;++h)f[h]=(+f[h]||0)&65535;else for(h=0,p=f.length;h<p;++h)f[h]=f[h]||0;if(e.type===t)for(h=0,p=f.length;h<p;++h)f[h]&1<<c*8-1&&(f[h]-=1<<c*8);return f.__klass=e,f.constructor=window[e.name],f.set=s,f.subarray=o,f.BYTES_PER_ELEMENT=e.bytes,f.byteLength=e.bytes*f.length,f.byteOffset=u||0,Object.defineProperty(f,"buffer",{get:function(){return new r(this)}}),f}var e=0,t=1,n=2,s=function(e,t){typeof t=="undefined"&&(t=0);var n,r=Math.min(this.length-t,e.length);for(n=0;n<r;++n)this[t+n]=e[n]},o=function(e,t){return typeof t=="undefined"&&(t=this.length),new this.constructor(this.slice(e,t))};[["Int8Array",1,t],["Uint8Array",1,e],["Int16Array",2,t],["Uint16Array",2,e],["Int32Array",4,t],["Uint32Array",4,e],["Float32Array",4,n],["Float64Array",8,n]].forEach(function(e){var t=e[0],n={bytes:e[1],type:e[2],name:t};window[t]=function(e,t,r){return i.call(this,n,e,t,r)}})}typeof Float32Array=="undefined"&&j();var t=function(){return g.apply(null,arguments)},n=Array.prototype.slice,r=0,i=1,s=2,o=3,u=[8e3,11025,12e3,16e3,22050,24e3,32e3,44100,48e3],a=[32,64,128,256],f="13.08.03",l=null,c={},h={},p=typeof module!="undefined"&&module.exports?"node":typeof window!="undefined"?"browser":"unknown",d=p==="browser"&&/(iPhone|iPad|iPod|Android)/i.test(navigator.userAgent),v=!1,m=120,g=function(){var t=n.call(arguments),r=t[0],i,s;switch(typeof r){case"string":c[r]?i=new c[r](t.slice(1)):h[r]?i=h[r](t.slice(1)):(s=/^(.+?)(?:\.(ar|kr))?$/.exec(r),s&&(r=s[1],c[r]?i=new c[r](t.slice(1)):h[r]&&(i=h[r](t.slice(1))),i&&s[2]&&i[s[2]]()));break;case"number":i=new L(t);break;case"boolean":i=new A(t);break;case"function":i=new O(t);break;case"object":if(r!==null){if(r instanceof N)return r;if(r.context instanceof N)return r.context;E(r)?i=new _(t):w(r)&&(i=new M(t))}}i===e&&(i=new k(t.slice(1)),console.warn('T("'+r+'") is not defined.'));var o=i._;return o.originkey=r,o.meta=y(i),o.emit("init"),i},y=function(e){var t=e._.meta,n,r,i=e;while(i!==null&&i.constructor!==Object){n=Object.getOwnPropertyNames(i);for(var s=0,o=n.length;s<o;++s){if(t[n[s]])continue;if(/^(constructor$|process$|_)/.test(n[s]))t[n[s]]="ignore";else{r=Object.getOwnPropertyDescriptor(i,n[s]);if(typeof r.value=="function")t[n[s]]="function";else if(r.get||r.set)t[n[s]]="property"}}i=Object.getPrototypeOf(i)}return t};Object.defineProperties(t,{version:{value:f},envtype:{value:p},envmobile:{value:d},env:{get:function(){return l.impl.env}},samplerate:{get:function(){return l.samplerate}},channels:{get:function(){return l.channels}},cellsize:{get:function(){return l.cellsize}},currentTime:{get:function(){return l.currentTime}},isPlaying:{get:function(){return l.status===i}},isRecording:{get:function(){return l.status===o}},amp:{set:function(e){typeof e=="number"&&(l.amp=e)},get:function(){return l.amp}},bpm:{set:function(e){typeof e=="number"&&5<=e&&e<=300&&(m=e)},get:function(){return m}}}),t.bind=function(e,n){return l.bind(e,n),t},t.setup=function(e){return l.setup(e),t},t.play=function(){return l.play(),t},t.pause=function(){return l.pause(),t},t.reset=function(){return l.reset(),l.events.emit("reset"),t},t.on=t.addListener=function(e,n){return l.on(e,n),t},t.once=function(e,n){return l.once(e,n),t},t.off=t.removeListener=function(e,n){return l.off(e,n),t},t.removeAllListeners=function(e){return l.removeAllListeners(e),t},t.listeners=function(e){return l.listeners(e)},t.rec=function(){return l.rec.apply(l,arguments)},t.timevalue=function(){var e=function(e){var t,n=m;if(t=/^bpm(\d+(?:\.\d+)?)/i.exec(e))n=Math.max(5,Math.min(300,+(t[1]||0)));return n};return function(n){var r,i,s;if(r=/^(\d+(?:\.\d+)?)Hz$/i.exec(n))return+r[1]===0?0:1e3/+r[1];if(r=/L(\d+)?(\.*)$/i.exec(n))return i=60/e(n)*(4/(r[1]||4))*1e3,i*=[1,1.5,1.75,1.875][(r[2]||"").length]||1,i;if(r=/^(\d+(?:\.\d+)?|\.(?:\d+))(min|sec|m)s?$/i.exec(n))switch(r[2]){case"min":return+(r[1]||0)*60*1e3;case"sec":return+(r[1]||0)*1e3;case"m":return+(r[1]||0)}return(r=/^(?:([0-5]?[0-9]):)?(?:([0-5]?[0-9]):)(?:([0-5]?[0-9]))(?:\.([0-9]{1,3}))?$/.exec(n))?(s=(r[1]||0)*3600+(r[2]||0)*60+(r[3]||0),s=s*1e3+(((r[4]||"")+"00").substr(0,3)|0),s):(r=/(\d+)\.(\d+)\.(\d+)$/i.exec(n))?(s=(r[1]*4+ +r[2])*480+ +r[3],60/e(n)*(s/480)*1e3):(r=/(\d+)ticks$/i.exec(n))?60/e(n)*(r[1]/480)*1e3:(r=/^(\d+)samples(?:\/(\d+)Hz)?$/i.exec(n))?r[1]*1e3/(r[2]||t.samplerate):0}}();var b=t.fn={SignalArray:Float32Array,currentTimeIncr:0,emptycell:null,FINISHED_STATE:r,PLAYING_STATE:i,UNSCHEDULED_STATE:s,SCHEDULED_STATE:o},w=b.isArray=Array.isArray,E=b.isDictionary=function(e){return typeof e=="object"&&e.constructor===Object};b.nop=function(){return this},b.isSignalArray=function(e){return e instanceof b.SignalArray?!0:Array.isArray(e)&&e.__klass&&e.__klass.type===2?!0:!1},b.extend=function(e,t){function r(){this.constructor=e}t=t||N;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},b.constructorof=function(e,t){var n=e&&e.prototype;while(n){if(n===t.prototype)return!0;n=Object.getPrototypeOf(n)}return!1},b.register=function(e,t){b.constructorof(t,N)?c[e]=t:h[e]=t},b.alias=function(e,t){c[t]?c[e]=c[t]:h[t]&&(h[e]=h[t])},b.getClass=function(e){return c[e]},b.pointer=function(e,t,n){return t=e.byteOffset+t*e.constructor.BYTES_PER_ELEMENT,typeof n=="number"?new e.constructor(e.buffer,t,n):new e.constructor(e.buffer,t)},b.nextTick=function(e){return l.nextTick(e),t},b.fixAR=function(e){e._.ar=!0,e._.aronly=!0},b.fixKR=function(e){e._.ar=!1,e._.kronly=!0},b.changeWithValue=function(){var e=this._,t=e.value*e.mul+e.add;isNaN(t)&&(t=0);var n=this.cells[0];for(var r=0,i=n.length;r<i;++r)n[r]=t},b.changeWithValue.unremovable=!0,b.clone=function(e){var t=new e.constructor([]);return t._.ar=e._.ar,t._.mul=e._.mul,t._.add=e._.add,t._.bypassed=e._.bypassed,t},b.timer=function(){var e=function(e){return function(){l.timers.indexOf(e)===-1&&(l.timers.push(e),l.events.emit("addObject"),e._.emit("start"),b.buddies_start(e))}},t=function(e){return function(){var t=l.timers.indexOf(e);t!==-1&&(l.timers.splice(t,1),e._.emit("stop"),l.events.emit("removeObject"),b.buddies_stop(e))}};return function(n){var r=e(n),i=t(n);return n.nodeType=N.TIMER,n.start=function(){return l.nextTick(r),n},n.stop=function(){return l.nextTick(i),n},n}}(),b.listener=function(){var e=function(e){return function(){l.listeners.indexOf(e)===-1&&(l.listeners.push(e),l.events.emit("addObject"),e._.emit("listen"),b.buddies_start(e))}},t=function(e){return function(){var t=l.listeners.indexOf(e);t!==-1&&(l.listeners.splice(t,1),e._.emit("unlisten"),l.events.emit("removeObject"),b.buddies_stop(e))}};return function(n){var r=e(n),i=t(n);return n.nodeType=N.LISTENER,n.listen=function(e){return arguments.length&&n.append.apply(n,arguments),n.nodes.length&&l.nextTick(r),n},n.unlisten=function(){return arguments.length&&n.remove.apply(n,arguments),n.nodes.length||l.nextTick(i),n},n}}(),b.make_onended=function(e,t){return function(){e.playbackState=r;if(typeof t=="number"){var n=e.cells[0],i=e.cells[1],s=e.cells[2];for(var o=0,u=i.length;o<u;++o)n[0]=i[o]=s[o]=t}e._.emit("ended")}},b.inputSignalAR=function(e){var t=e.cells[0],n=e.cells[1],r=e.cells[2],s=e.nodes,o,u=s.length,a,f=t.length,l=e.tickID,c,h,p,d;if(e.numChannels===2){c=!0;if(u!==0){for(o=0;o<u;++o)if(s[o].playbackState===i){s[o].process(l),n.set(s[o].cells[1]),r.set(s[o].cells[2]),c=!1,++o;break}for(;o<u;++o)if(s[o].playbackState===i){s[o].process(l),p=s[o].cells[1],d=s[o].cells[2];for(a=f;a;)a-=8,n[a]+=p[a],r[a]+=d[a],n[a+1]+=p[a+1],r[a+1]+=d[a+1],n[a+2]+=p[a+2],r[a+2]+=d[a+2],n[a+3]+=p[a+3],r[a+3]+=d[a+3],n[a+4]+=p[a+4],r[a+4]+=d[a+4],n[a+5]+=p[a+5],r[a+5]+=d[a+5],n[a+6]+=p[a+6],r[a+6]+=d[a+6],n[a+7]+=p[a+7],r[a+7]+=d[a+7]}}c&&(n.set(b.emptycell),r.set(b.emptycell))}else{c=!0;if(u!==0){for(o=0;o<u;++o)if(s[o].playbackState===i){s[o].process(l),t.set(s[o].cells[0]),c=!1,++o;break}for(;o<u;++o)if(s[o].playbackState===i){h=s[o].process(l).cells[0];for(a=f;a;)a-=8,t[a]+=h[a],t[a+1]+=h[a+1],t[a+2]+=h[a+2],t[a+3]+=h[a+3],t[a+4]+=h[a+4],t[a+5]+=h[a+5],t[a+6]+=h[a+6],t[a+7]+=h[a+7]}}c&&t.set(b.emptycell)}},b.inputSignalKR=function(e){var t=e.nodes,n,r=t.length,s=e.tickID,o=0;for(n=0;n<r;++n)t[n].playbackState===i&&(o+=t[n].process(s).cells[0][0]);return o},b.outputSignalAR=function(e){var t=e.cells[0],n=e.cells[1],r=e.cells[2],i=e._.mul,s=e._.add,o;if(e.numChannels===2)for(o=t.length;o;)o-=8,n[o]=n[o]*i+s,r[o]=r[o]*i+s,n[o+1]=n[o+1]*i+s,r[o+1]=r[o+1]*i+s,n[o+2]=n[o+2]*i+s,r[o+2]=r[o+2]*i+s,n[o+3]=n[o+3]*i+s,r[o+3]=r[o+3]*i+s,n[o+4]=n[o+4]*i+s,r[o+4]=r[o+4]*i+s,n[o+5]=n[o+5]*i+s,r[o+5]=r[o+5]*i+s,n[o+6]=n[o+6]*i+s,r[o+6]=r[o+6]*i+s,n[o+7]=n[o+7]*i+s,r[o+7]=r[o+7]*i+s,t[o]=(n[o]+r[o])*.5,t[o+1]=(n[o+1]+r[o+1])*.5,t[o+2]=(n[o+2]+r[o+2])*.5,t[o+3]=(n[o+3]+r[o+3])*.5,t[o+4]=(n[o+4]+r[o+4])*.5,t[o+5]=(n[o+5]+r[o+5])*.5,t[o+6]=(n[o+6]+r[o+6])*.5,t[o+7]=(n[o+7]+r[o+7])*.5;else if(i!==1||s!==0)for(o=t.length;o;)o-=8,t[o]=t[o]*i+s,t[o+1]=t[o+1]*i+s,t[o+2]=t[o+2]*i+s,t[o+3]=t[o+3]*i+s,t[o+4]=t[o+4]*i+s,t[o+5]=t[o+5]*i+s,t[o+6]=t[o+6]*i+s,t[o+7]=t[o+7]*i+s},b.outputSignalKR=function(e){var t=e.cells[0],n=e.cells[1],r=e.cells[2],i=e._.mul,s=e._.add,o=t[0]*i+s,u;if(e.numChannels===2)for(u=t.length;u;)u-=8,t[u]=t[u+1]=t[u+2]=t[u+3]=t[u+4]=t[u+5]=t[u+6]=t[u+7]=n[u]=n[u+1]=n[u+2]=n[u+3]=n[u+4]=n[u+5]=n[u+6]=n[u+7]=r[u]=r[u+1]=r[u+2]=r[u+3]=r[u+4]=r[u+5]=r[u+6]=r[u+7]=o;else for(u=t.length;u;)u-=8,t[u]=t[u+1]=t[u+2]=t[u+3]=t[u+4]=t[u+5]=t[u+6]=t[u+7]=o},b.buddies_start=function(e){var t=e._.buddies,n,r,i;for(r=0,i=t.length;r<i;++r){n=t[r];switch(n.nodeType){case N.DSP:n.play();break;case N.TIMER:n.start();break;case N.LISTENER:n.listen()}}},b.buddies_stop=function(e){var t=e._.buddies,n,r,i;for(r=0,i=t.length;r<i;++r){n=t[r];switch(n.nodeType){case N.DSP:n.pause();break;case N.TIMER:n.stop();break;case N.LISTENER:n.unlisten()}}},b.fix_iOS6_1_problem=function(e){l.fix_iOS6_1_problem(e)};var S=t.modules={},x=S.EventEmitter=function(){function e(e){this.context=e,this.events={}}var t=e.prototype;return t.emit=function(e){var t=this.events[e];if(!t)return!1;var r;if(typeof t=="function"){switch(arguments.length){case 1:t.call(this.context);break;case 2:t.call(this.context,arguments[1]);break;case 3:t.call(this.context,arguments[1],arguments[2]);break;default:r=n.call(arguments,1),t.apply(this.context,r)}return!0}if(w(t)){r=n.call(arguments,1);var i=t.slice();for(var s=0,o=i.length;s<o;++s)i[s]instanceof N?i[s].bang.apply(i[s],r):i[s].apply(this.context,r);return!0}if(!(t instanceof N))return!1;r=n.call(arguments,1),t.bang.apply(t,r)},t.on=function(e,t){if(typeof t=="function"||t instanceof N){var n=this.events;return n[e]?w(n[e])?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this}throw new Error("addListener takes instances of Function or timbre.Object")},t.once=function(e,t){var n=this,r;if(typeof t=="function")r=function(){n.off(e,r),t.apply(n.context,arguments)};else{if(!(t instanceof N))throw new Error("once takes instances of Function or timbre.Object");r=function(){n.off(e,r),t.bang.apply(t,arguments)}}return r.listener=t,n.on(e,r),this},t.off=function(e,t){if(typeof t=="function"||t instanceof N){var n=this.events;if(!n[e])return this;var r=n[e];if(w(r)){var i=-1;for(var s=0,o=r.length;s<o;++s)if(r[s]===t||r[s].listener&&r[s].listener===t){i=s;break}if(i<0)return this;r.splice(i,1),r.length===0&&(n[e]=null)}else if(r===t||r.listener&&r.listener===t)n[e]=null;return this}throw new Error("removeListener takes instances of Function or timbre.Object")},t.removeAllListeners=function(e){var t=this.events,n=!1,r=t[e];if(w(r))for(var i=r.length;i--;){var s=r[i];if(s.unremovable){n=!0;continue}this.off(e,s)}else r&&(r.unremovable?n=!0:this.off(e,r));return n||(t[e]=null),this},t.listeners=function(e){var t,n=this.events;if(!n[e])return[];n=n[e];if(!w(n))return n.unremovable?[]:[n];n=n.slice(),t=[];for(var r=0,i=n.length;r<i;++r)n[r].unremovable||t.push(n[r]);return t},e}(),T=S.Deferred=function(){function e(e){this.context=e||this,this._state="pending",this._doneList=[],this._failList=[],this._promise=new s(this)}function s(e){this.context=e.context,this.then=e.then,this.done=function(){return e.done.apply(e,arguments),this},this.fail=function(){return e.fail.apply(e,arguments),this},this.pipe=function(){return e.pipe.apply(e,arguments)},this.always=function(){return e.always.apply(e,arguments),this},this.promise=function(){return this},this.isResolved=function(){return e.isResolved()},this.isRejected=function(){return e.isRejected()}}var t=e.prototype,r=function(e,t,n,r){if(this._state==="pending"){this._state=e;for(var i=0,s=t.length;i<s;++i)t[i].apply(n,r);this._doneList=this._failList=null}},i=function(e){return e&&typeof e.promise=="function"};return t.resolve=function(){var e=n.call(arguments,0);return r.call(this,"resolved",this._doneList,this.context||this,e),this},t.resolveWith=function(e){var t=n.call(arguments,1);return r.call(this,"resolved",this._doneList,e,t),this},t.reject=function(){var e=n.call(arguments,0);return r.call(this,"rejected",this._failList,this.context||this,e),this},t.rejectWith=function(e){var t=n.call(arguments,1);return r.call(this,"rejected",this._failList,e,t),this},t.promise=function(){return this._promise},t.done=function(){var e=n.call(arguments),t=this._state==="resolved",r=this._state==="pending",i=this._doneList;for(var s=0,o=e.length;s<o;++s)typeof e[s]=="function"&&(t?e[s]():r&&i.push(e[s]));return this},t.fail=function(){var e=n.call(arguments),t=this._state==="rejected",r=this._state==="pending",i=this._failList;for(var s=0,o=e.length;s<o;++s)typeof e[s]=="function"&&(t?e[s]():r&&i.push(e[s]));return this},t.always=function(){return this.done.apply(this,arguments),this.fail.apply(this,arguments),this},t.then=function(t,n){return this.done(t).fail(n)},t.pipe=function(t,r){var s=this,o=new e(this.context);return this.done(function(){var e=t.apply(s.context,arguments);i(e)?e.then(function(){var t=n.call(arguments);o.resolveWith.apply(o,[e].concat(t))}):o.resolveWith(s,e)}),this.fail(function(){if(typeof r=="function"){var e=r.apply(s.context,arguments);i(e)&&e.fail(function(){var t=n.call(arguments);o.rejectWith.apply(o,[e].concat(t))})}else o.reject.apply(o,arguments)}),o.promise()},t.isResolved=function(){return this._state==="resolved"},t.isRejected=function(){return this._state==="rejected"},t.state=function(){return this._state},e.when=function(t){var r=0,s=n.call(arguments),o=s.length,u=o;o===1&&!i(t)&&(u=0);var a=u===1?t:new e,f=function(e,t){return function(r){t[e]=arguments.length>1?n.call(arguments):r,--u||a.resolve.apply(a,t)}};if(o>1){var l=new Array(o),c=function(){a.reject()};for(;r<o;++r)s[r]&&i(s[r])?s[r].promise().done(f(r,l)).fail(c):(l[r]=s[r],--u)}return u||a.resolve.apply(a,s),a.promise()},e}(),N=t.Object=function(){function r(e,n){this._={};var s=this._.events=new x(this);this._.emit=function(){return s.emit.apply(s,arguments)};if(E(n[0])){var o=n.shift(),u=o["in"];this.once("init",function(){this.set(o),u&&(w(u)?this.append.apply(this,u):u instanceof r&&this.append(u))})}this.tickID=-1,this.nodes=n.map(t),this.cells=[],this.numChannels=e;switch(e){case 0:this.L=this.R=new C(null),this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 1:this.L=this.R=new C(this),this.cells[0]=this.cells[1]=this.cells[2]=this.L.cell;break;case 2:this.L=new C(this),this.R=new C(this),this.cells[0]=new b.SignalArray(l.cellsize),this.cells[1]=this.L.cell,this.cells[2]=this.R.cell}this.playbackState=i,this.nodeType=r.DSP,this._.ar=!0,this._.mul=1,this._.add=0,this._.dac=null,this._.bypassed=!1,this._.meta={},this._.samplerate=l.samplerate,this._.cellsize=l.cellsize,this._.buddies=[]}r.DSP=1,r.TIMER=2,r.LISTENER=3;var s=r.prototype;return Object.defineProperties(s,{isAr:{get:function(){return this._.ar}},isKr:{get:function(){return!this._.ar}},isBypassed:{get:function(){return this._.bypassed}},isEnded:{get:function(){return!(this.playbackState&1)}},mul:{set:function(e){typeof e=="number"&&(this._.mul=e,this._.emit("setMul",e))},get:function(){return this._.mul}},add:{set:function(e){typeof e=="number"&&(this._.add=e,this._.emit("setAdd",e))},get:function(){return this._.add}},buddies:{set:function(e){w(e)||(e=[e]),this._.buddies=e.filter(function(e){return e instanceof r})},get:function(){return this._.buddies}}}),s.toString=function(){return this.constructor.name},s.valueOf=function(){return l.tickID!==this.tickID&&this.process(l.tickID),this.cells[0][0]},s.append=function(){if(arguments.length>0){var e=n.call(arguments).map(t);this.nodes=this.nodes.concat(e),this._.emit("append",e)}return this},s.appendTo=function(e){return e.append(this),this},s.remove=function(){if(arguments.length>0){var e,t=this.nodes,n=[];for(var r=0,i=arguments.length;r<i;++r)(e=t.indexOf(arguments[r]))!==-1&&(n.push(t[e]),t.splice(e,1));n.length>0&&this._.emit("remove",n)}return this},s.removeFrom=function(e){return e.remove(this),this},s.removeAll=function(){var e=this.nodes.slice();return this.nodes=[],e.length>0&&this._.emit("remove",e),this},s.removeAtIndex=function(e){var t=this.nodes[e];return t&&(this.nodes.splice(e,1),this._.emit("remove",[t])),this},s.postMessage=function(e){return this._.emit("message",e),this},s.to=function(e){if(e instanceof r)e.append(this);else{var t=n.call(arguments);E(t[1])?t.splice(2,0,this):t.splice(1,0,this),e=g.apply(null,t)}return e},s.splice=function(e,t,n){var i;return t?t instanceof r&&(i=t.nodes.indexOf(n),i!==-1&&t.nodes.splice(i,1),e instanceof r?(e.nodes.push(this),t.nodes.push(e)):t.nodes.push(this)):this._.dac&&(e instanceof r?n instanceof r?n._.dac&&(n._.dac._.node=e,e._.dac=n._.dac,n._.dac=null,e.nodes.push(this)):this._.dac&&(this._.dac._.node=e,e._.dac=this._.dac,this._.dac=null,e.nodes.push(this)):n instanceof r&&n._.dac&&(n._.dac._.node=this,this._.dac=n._.dac,n._.dac=null)),this},s.on=s.addListener=function(e,t){return this._.events.on(e,t),this},s.once=function(e,t){return this._.events.once(e,t),this},s.off=s.removeListener=function(e,t){return this._.events.off(e,t),this},s.removeAllListeners=function(e){return this._.events.removeAllListeners(e),this},s.listeners=function(e){return this._.events.listeners(e)},s.set=function(e,t){var n,r,i=this._.meta;switch(typeof e){case"string":switch(i[e]){case"property":this[e]=t;break;case"function":this[e](t);break;default:n=this;while(n!==null){r=Object.getOwnPropertyDescriptor(n,e);if(r)if(typeof r.value=="function")i[e]="function",this[e](t);else if(r.get||r.set)i[e]="property",this[e]=t;n=Object.getPrototypeOf(n)}}break;case"object":for(n in e)this.set(n,e[n])}return this},s.get=function(e){if(this._.meta[e]==="property")return this[e]},s.bang=function(){return this._.emit.apply(this,["bang"].concat(n.call(arguments))),this},s.process=b.nop,s.bypass=function(){return this._.bypassed=arguments.length===0?!0:!!arguments[0],this},s.play=function(){var e=this._.dac;return e===null&&(e=this._.dac=new D(this)),e.play()&&this._.emit.apply(this,["play"].concat(n.call(arguments))),b.buddies_start(this),this},s.pause=function(){var e=this._.dac;return e&&e.playbackState===i&&(e.pause(),this._.dac=null,this._.emit("pause")),b.buddies_stop(this),this},s.start=s.stop=s.listen=s.unlisten=function(){return this},s.ar=function(){return(arguments.length===0?!0:!!arguments[0])?this._.kronly||(this._.ar=!0,this._.emit("ar",!0)):this.kr(!0),this},s.kr=function(){return(arguments.length===0?!0:!!arguments[0])?this._.aronly||(this._.ar=!1,this._.emit("ar",!1)):this.ar(!0),this},p==="browser"?s.plot=function(t){var n=this._,r=t.target;if(!r)return this;var i=t.width||r.width||320,s=t.height||r.height||240,o=(t.x||0)+.5,u=t.y||0,a=r.getContext("2d"),f;t.foreground!==e?f=t.foreground:f=n.plotForeground||"rgb(  0, 128, 255)";var l;t.background!==e?l=t.background:l=n.plotBackground||"rgb(255, 255, 255)";var c=t.lineWidth||n.plotLineWidth||1,h=!!n.plotCyclic,p=n.plotData||this.cells[0],d=t.range||n.plotRange||[-1.2,1.2],v=d[0],m=s/(d[1]-v),g,y=i/p.length,b,w,E,S,x=p.length;a.save(),a.rect(o,u,i,s),l!==null&&(a.fillStyle=l,a.fillRect(o,u,i,s)),n.plotBefore&&n.plotBefore.call(this,a,o,u,i,s);if(n.plotBarStyle){a.fillStyle=f,g=0;for(S=0;S<x;++S)w=(p[S]-v)*m,b=s-w,a.fillRect(g+o,b+u,y,w),g+=y}else{a.strokeStyle=f,a.lineWidth=c,a.beginPath(),g=0,E=s-(p[0]-v)*m,a.moveTo(g+o,E+u);for(S=1;S<x;++S)g+=y,b=s-(p[S]-v)*m,a.lineTo(g+o,b+u);h?a.lineTo(g+y+o,E+u):a.lineTo(g+y+o,b+u),a.stroke()}n.plotAfter&&n.plotAfter.call(this,a,o,u,i,s);var T=t.border||n.plotBorder;return T&&(a.strokeStyle=typeof T=="string"?T:"#000",a.lineWidth=1,a.strokeRect(o,u,i,s)),a.restore(),this}:s.plot=b.nop,r}(),C=t.ChannelObject=function(){function e(e){t.Object.call(this,-1,[]),b.fixAR(this),this._.parent=e,this.cell=new b.SignalArray(l.cellsize),this.L=this.R=this,this.cells[0]=this.cells[1]=this.cells[2]=this.cell,this.numChannels=1}return b.extend(e),e.prototype.process=function(e){return this.tickID!==e&&(this.tickID=e,this._.parent&&this._.parent.process(e)),this},e}(),k=function(){function e(e){N.call(this,2,e)}return b.extend(e),e.prototype.process=function(e){var t=this._;return this.tickID!==e&&(this.tickID=e,t.ar?(b.inputSignalAR(this),b.outputSignalAR(this)):(this.cells[0][0]=b.inputSignalKR(this),b.outputSignalKR(this))),this},b.register("+",e),e}(),L=function(){function e(e){N.call(this,1,[]),b.fixKR(this),this.value=e[0];if(E(e[1])){var t=e[1];this.once("init",function(){this.set(t)})}this.on("setAdd",b.changeWithValue),this.on("setMul",b.changeWithValue)}b.extend(e);var t=e.prototype;return Object.defineProperties(t,{value:{set:function(e){typeof e=="number"&&(this._.value=isNaN(e)?0:e,b.changeWithValue.call(this))},get:function(){return this._.value}}}),e}(),A=function(){function e(e){N.call(this,1,[]),b.fixKR(this),this.value=e[0];if(E(e[1])){var t=e[1];this.once("init",function(){this.set(t)})}this.on("setAdd",b.changeWithValue),this.on("setMul",b.changeWithValue)}b.extend(e);var t=e.prototype;return Object.defineProperties(t,{value:{set:function(e){this._.value=e?1:0,b.changeWithValue.call(this)},get:function(){return!!this._.value}}}),e}(),O=function(){function e(e){N.call(this,1,[]),b.fixKR(this),this.func=e[0],this._.value=0;if(E(e[1])){var t=e[1];this.once("init",function(){this.set(t)})}this.on("setAdd",b.changeWithValue),this.on("setMul",b.changeWithValue)}b.extend(e);var t=e.prototype;return Object.defineProperties(t,{func:{set:function(e){typeof e=="function"&&(this._.func=e)},get:function(){return this._.func}},args:{set:function(e){w(e)?this._.args=e:this._.args=[e]},get:function(){return this._.args}}}),t.bang=function(){var e=this._,t=n.call(arguments).concat(e.args),r=e.func.apply(this,t);return typeof r=="number"&&(e.value=r,b.changeWithValue.call(this)),this._.emit("bang"),this},e}(),M=function(){function e(e){N.call(this,1,[]);var t,n;for(t=0,n=e[0].length;t<n;++t)this.append(e[0][t]);if(E(e[1])){var r=e[1];this.once("init",function(){this.set(r)})}}b.extend(e);var t=e.prototype;return Object.defineProperties(t,{}),t.bang=function(){var e=["bang"].concat(n.call(arguments)),t=this.nodes,r,i;for(r=0,i=t.length;r<i;++r)t[r].bang.apply(t[r],e);return this},t.postMessage=function(e){var t=this.nodes,n,r;for(n=0,r=t.length;n<r;++n)t[n].postMessage(e);return this},t.process=function(e){var t=this._;return this.tickID!==e&&(this.tickID=e,t.ar?(b.inputSignalAR(this),b.outputSignalAR(this)):(this.cells[0][0]=b.inputSignalKR(this),b.outputSignalKR(this))),this},e}(),_=function(){function e(e){N.call(this,1,[]),b.fixKR(this);if(E(e[1])){var t=e[1];this.once("init",function(){this.set(t)})}}b.extend(e);var t=e.prototype;return Object.defineProperties(t,{}),e}(),D=function(){function e(e){N.call(this,2,[]),this.playbackState=r;var i=this._;i.node=e,i.onplay=t(this),i.onpause=n(this)}b.extend(e);var t=function(e){return function(){l.inlets.indexOf(e)===-1&&(l.inlets.push(e),l.events.emit("addObject"),e.playbackState=i,e._.emit("play"))}},n=function(e){return function(){var t=l.inlets.indexOf(e);t!==-1&&(l.inlets.splice(t,1),e.playbackState=r,e._.emit("pause"),l.events.emit("removeObject"))}},s=e.prototype;return s.play=function(){return l.nextTick(this._.onplay),l.inlets.indexOf(this)===-1},s.pause=function(){l.nextTick(this._.onpause)},s.process=function(e){var t=this._.node;t.playbackState&1?(t.process(e),this.cells[1].set(t.cells[1]),this.cells[2].set(t.cells[2])):(this.cells[1].set(b.emptycell),this.cells[2].set(b.emptycell))},e}(),P=function(){function e(){this.context=this,this.tickID=0,this.impl=null,this.amp=.8,this.status=r,this.samplerate=44100,this.channels=2,this.cellsize=64,this.streammsec=20,this.streamsize=0,this.currentTime=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this.deferred=null,this.recStart=0,this.recBuffers=null,this.delayProcess=t(this),this.events=null,b.currentTimeIncr=this.cellsize*1e3/this.samplerate,b.emptycell=new b.SignalArray(this.cellsize),this.reset(!0)}var t=function(e){return function(){e.recStart=Date.now(),e.process()}},s=e.prototype;s.bind=function(e,t){if(typeof e=="function"){var n=new e(this,t);this.impl=n,this.impl.defaultSamplerate&&(this.samplerate=this.impl.defaultSamplerate)}return this},s.setup=function(e){return typeof e=="object"&&(u.indexOf(e.samplerate)!==-1&&(e.samplerate<=this.impl.maxSamplerate?this.samplerate=e.samplerate:this.samplerate=this.impl.maxSamplerate),a.indexOf(e.cellsize)!==-1&&(this.cellsize=e.cellsize),typeof Float64Array!="undefined"&&typeof e.f64!="undefined"&&(v=!!e.f64,v?b.SignalArray=Float64Array:b.SignalArray=Float32Array)),b.currentTimeIncr=this.cellsize*1e3/this.samplerate,b.emptycell=new b.SignalArray(this.cellsize),this},s.getAdjustSamples=function(e){var t,n;return e=e||this.samplerate,t=this.streammsec/1e3*e,n=Math.ceil(Math.log(t)*Math.LOG2E),n=n<8?8:n>14?14:n,1<<n},s.play=function(){return this.status===r&&(this.status=i,this.streamsize=this.getAdjustSamples(),this.strmL=new b.SignalArray(this.streamsize),this.strmR=new b.SignalArray(this.streamsize),this.impl.play(),this.events.emit("play")),this},s.pause=function(){return this.status===i&&(this.status=r,this.impl.pause(),this.events.emit("pause")),this},s.reset=function(e){return e&&(this.events=(new x(this)).on("addObject",function(){this.status===r&&this.play()}).on("removeObject",function(){this.status===i&&this.inlets.length+this.timers.length+this.listeners.length===0&&this.pause()})),this.currentTime=0,this.nextTicks=[],this.inlets=[],this.timers=[],this.listeners=[],this},s.process=function(){var e=this.tickID,t=this.strmL,n=this.strmR,r=this.amp,i,s,u,a,f=this.streamsize,l=0,c,h,p,d=this.cellsize,v=this.streamsize/this.cellsize,m,g=this.timers,y=this.inlets,w=this.listeners,E=b.currentTimeIncr;for(a=0;a<f;++a)t[a]=n[a]=0;while(v--){++e;for(c=0,h=g.length;c<h;++c)g[c].playbackState&1&&g[c].process(e);for(c=0,h=y.length;c<h;++c){i=y[c],i.process(e);if(i.playbackState&1){s=i.cells[1],u=i.cells[2];for(p=0,a=l;p<d;++p,++a)t[a]+=s[p],n[a]+=u[p]}}l+=d;for(c=0,h=w.length;c<h;++c)w[c].playbackState&1&&w[c].process(e);this.currentTime+=E,m=this.nextTicks.splice(0);for(c=0,h=m.length;c<h;++c)m[c]()}for(a=0;a<f;++a)i=t[a]*r,i<-1?i=-1:i>1&&(i=1),t[a]=i,i=n[a]*r,i<-1?i=-1:i>1&&(i=1),n[a]=i;this.tickID=e;var S=this.currentTime;if(this.status===o){if(this.recCh===2)this.recBuffers.push(new b.SignalArray(t)),this.recBuffers.push(new b.SignalArray(n));else{var x=new b.SignalArray(t.length);for(a=0,f=x.length;a<f;++a)x[a]=(t[a]+n[a])*.5;this.recBuffers.push(x)}if(S>=this.maxDuration)this.deferred.sub.reject();else if(S>=this.recDuration)this.deferred.sub.resolve();else{var T=Date.now();T-this.recStart>20?setTimeout(this.delayProcess,10):this.process()}}},s.nextTick=function(e){this.status===r?e():this.nextTicks.push(e)},s.rec=function(){b.fix_iOS6_1_problem(!0);var e=new T(this);if(this.deferred)return console.warn("rec deferred is exists??"),e.reject().promise();if(this.status!==r)return console.log("status is not none",this.status),e.reject().promise();var t=0,i=arguments,s=E(i[t])?i[t++]:{},u=i[t];if(typeof u!="function")return console.warn("no function"),e.reject().promise();this.deferred=e,this.status=o,this.reset();var a=new g("+"),l=new T(this),c={done:function(){l.resolve.apply(l,n.call(arguments))},send:function(){a.append.apply(a,arguments)}},h=this;return l.then(f,function(){b.fix_iOS6_1_problem(!1),f.call(h,!0)}),this.deferred.sub=l,this.savedSamplerate=this.samplerate,this.samplerate=s.samplerate||this.samplerate,this.recDuration=s.recDuration||Infinity,this.maxDuration=s.maxDuration||6e5,this.recCh=s.ch||1,this.recCh!==2&&(this.recCh=1),this.recBuffers=[],this.streamsize=this.getAdjustSamples(),this.strmL=new b.SignalArray(this.streamsize),this.strmR=new b.SignalArray(this.streamsize),this.inlets.push(a),u(c),setTimeout(this.delayProcess,10),e.promise()};var f=function(){this.status=r,this.reset();var e=this.recBuffers,t=this.samplerate,n=this.streamsize,i;this.samplerate=this.savedSamplerate,this.recDuration!==Infinity?i=this.recDuration*t*.001|0:i=(e.length>>this.recCh-1)*n;var s,o,u=i/n|0,a=0,f=0,l=i;if(this.recCh===2){var c=new b.SignalArray(i),h=new b.SignalArray(i),p=new b.SignalArray(i);for(o=0;o<u;++o){c.set(e[a++],f),h.set(e[a++],f),f+=n,l-=n;if(l>0&&l<n){c.set(e[a++].subarray(0,l),f),h.set(e[a++].subarray(0,l),f);break}}for(o=0,u=i;o<u;++o)p[o]=(c[o]+h[o])*.5;s={samplerate:t,channels:2,buffer:[p,c,h]}}else{var d=new b.SignalArray(i);for(o=0;o<u;++o){d.set(e[a++],f),f+=n,l-=n;if(l>0&&l<n){d.set(e[a++].subarray(0,l),f);break}}s={samplerate:t,channels:1,buffer:[d]}}var v=[].concat.apply([s],arguments);this.deferred.resolve.apply(this.deferred,v),this.deferred=null};return s.on=function(e,t){this.events.on(e,t)},s.once=function(e,t){this.events.once(e,t)},s.off=function(e,t){this.events.off(e,t)},s.removeAllListeners=function(e){this.events.removeListeners(e)},s.listeners=function(e){return this.events.listeners(e)},s.fix_iOS6_1_problem=function(e){this.impl.fix_iOS6_1_problem&&this.impl.fix_iOS6_1_problem(e)},e}(),H=null;typeof webkitAudioContext!="undefined"?H=function(e){var t=new webkitAudioContext,n,r;b._audioContext=t,this.maxSamplerate=t.sampleRate,this.defaultSamplerate=t.sampleRate,this.env="webkit";var i=navigator.userAgent;i.match(/linux/i)?e.streammsec*=8:i.match(/win(dows)?\s*(nt 5\.1|xp)/i)&&(e.streammsec*=4),this.play=function(){var i,s=e.getAdjustSamples(t.sampleRate),o=e.streamsize,u,a;e.samplerate===t.sampleRate?i=function(t){var n=t.outputBuffer;e.process(),n.getChannelData(0).set(e.strmL),n.getChannelData(1).set(e.strmR)}:e.samplerate*2===t.sampleRate?i=function(t){var n=e.strmL,r=e.strmR,i=t.outputBuffer,s=i.getChannelData(0),o=i.getChannelData(1),u,a=i.length,f;e.process();for(u=f=0;u<a;u+=2,++f)s[u]=s[u+1]=n[f],o[u]=o[u+1]=r[f]}:(u=o,a=e.samplerate/t.sampleRate,i=function(t){var n=e.strmL,r=e.strmR,i=t.outputBuffer,s=i.getChannelData(0),f=i.getChannelData(1),l,c=i.length;for(l=0;l<c;++l)u>=o&&(e.process(),u-=o),s[l]=n[u|0],f[l]=r[u|0],u+=a}),n=t.createBufferSource(),r=t.createJavaScriptNode(s,2,e.channels),r.onaudioprocess=i,n.noteOn(0),n.connect(r),r.connect(t.destination)},this.pause=function(){n.disconnect(),r.disconnect()};if(d){var s=0,o=t.createBufferSource();this.fix_iOS6_1_problem=function(e){s+=e?1:-1,s===1?(o.noteOn(0),o.connect(t.destination)):s===0&&o.disconnect()}}}:typeof Audio=="function"&&typeof (new Audio).mozSetup=="function"?H=function(e){var t=function(){var e="var t=0;onmessage=function(e){if(t)t=clearInterval(t),0;if(typeof e.data=='number'&&e.data>0)t=setInterval(function(){postMessage(0);},e.data);};",t=new Blob([e],{type:"text/javascript"}),n=URL.createObjectURL(t);return new Worker(n)}();this.maxSamplerate=48e3,this.defaultSamplerate=44100,this.env="moz",this.play=function(){var n=new Audio,r=new Float32Array(e.streamsize*e.channels),i=e.streammsec,s=0,o=e.streamsize/e.samplerate*1e3,u=Date.now(),a=function(){if(s>Date.now()-u)return;var t=e.strmL,i=e.strmR,a=r.length,f=t.length;e.process();while(f--)r[--a]=i[f],r[--a]=t[f];n.mozWriteAudio(r),s+=o};n.mozSetup(e.channels,e.samplerate),t.onmessage=a,t.postMessage(i)},this.pause=function(){t.postMessage(0)}}:H=function(e){this.maxSamplerate=48e3,this.defaultSamplerate=44100,this.env="nop",this.play=function(){},this.pause=function(){}},l=(new P).bind(H);var B=t;p==="node"?module.exports=global.timbre=B:p==="browser"&&(B.noConflict=function(){var e=window.timbre,t=window.T;return function(n){return window.T===B&&(window.T=t),n&&window.timbre===B&&(window.timbre=e),B}}(),window.timbre=window.T=B),function(){function c(t){try{return e.plugins&&e.mimeTypes&&e.mimeTypes.length?e.plugins["Shockwave Flash"].description.match(/([0-9]+)/)[t]:(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version").match(/([0-9]+)/)[t]}catch(n){return-1}}if(l.impl.env!=="nop"||p!=="browser"||d)return;var e=navigator;if(c(0)<10)return;var t,n="TimbreFlashPlayerDiv",r=function(){var e=document.getElementsByTagName("script");if(e&&e.length)for(var t,n=0,r=e.length;n<r;++n)if(t=/^(.*\/)timbre(?:\.dev)?\.js$/i.exec(e[n].src))return t[1]+"timbre.swf"}();window.timbrejs_flashfallback_init=function(){function e(e){var n=0;this.maxSamplerate=44100,this.defaultSamplerate=44100,this.env="flash",this.play=function(){var i,s=new Array(e.streamsize*e.channels),o=e.streammsec,u=0,a=e.streamsize/e.samplerate*1e3,f=Date.now();i=function(){if(u>Date.now()-f)return;var n=e.strmL,r=e.strmR,i=s.length,o=n.length;e.process();while(o--)s[--i]=r[o]*32768|0,s[--i]=n[o]*32768|0;t.writeAudio(s.join(" ")),u+=a},t.setup?(t.setup(e.channels,e.samplerate),n=setInterval(i,o)):console.warn("Cannot find "+r)},this.pause=function(){n!==0&&(t.cancel(),clearInterval(n),n=0)}}l.bind(e),delete window.timbrejs_flashfallback_init};var i,s,o=r,u=o+"?"+ +(new Date),a="TimbreFlashPlayer",f=document.createElement("div");f.id=n,f.style.display="inline",f.width=f.height=1,e.plugins&&e.mimeTypes&&e.mimeTypes.length?(i=document.createElement("object"),i.id=a,i.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",i.width=i.height=1,i.setAttribute("data",u),i.setAttribute("type","application/x-shockwave-flash"),s=document.createElement("param"),s.setAttribute("name","allowScriptAccess"),s.setAttribute("value","always"),i.appendChild(s),f.appendChild(i)):f.innerHTML='<object id="'+a+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1"><param name="movie" value="'+u+'" /><param name="bgcolor" value="#FFFFFF" /><param name="quality" value="high" /><param name="allowScriptAccess" value="always" /></object>',window.addEventListener("load",function(){document.body.appendChild(f),t=document[a]})}()})(),function(e){function t(e){this.samplerate=e,this.frequency=340,this.Q=1,this.gain=0,this.x1L=this.x2L=this.y1L=this.y2L=0,this.x1R=this.x2R=this.y1R=this.y2R=0,this.b0=this.b1=this.b2=this.a1=this.a2=0,this.setType("lpf")}var n=t.prototype;n.process=function(e,t){var n,r,i,s,o=this.x1L,u=this.x2L,a=this.y1L,f=this.y2L,l=this.x1R,c=this.x2R,h=this.y1R,p=this.y2R,d=this.b0,v=this.b1,m=this.b2,g=this.a1,y=this.a2,b,w;for(b=0,w=e.length;b<w;++b)n=e[b],i=d*n+v*o+m*u-g*a-y*f,u=o,o=n,f=a,a=i,r=t[b],s=d*r+v*l+m*c-g*h-y*p,c=l,l=r,p=h,h=s,e[b]=i,t[b]=s;this.x1L=o,this.x2L=u,this.y1L=a,this.y2L=f,this.x1R=l,this.x2R=c,this.y1R=h,this.y2R=p},n.setType=function(e){var t;if(t=r[e])this.type=e,t.call(this,this.frequency,this.Q,this.gain)},n.setParams=function(e,t,n){this.frequency=e,this.Q=t,this.gain=n;var i=r[this.type];return i&&i.call(this,e,t,n),this};var r={lowpass:function(e,t){e/=this.samplerate*.5;if(e>=1)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(e<=0)this.b0=this.b1=this.b2=this.a1=this.a2=0;else{t=t<0?0:t;var n=Math.pow(10,.05*t),r=Math.sqrt((4-Math.sqrt(16-16/(n*n)))*.5),i=Math.PI*e,s=.5*r*Math.sin(i),o=.5*(1-s)/(1+s),u=(.5+o)*Math.cos(i),a=.25*(.5+o-u);this.b0=2*a,this.b1=4*a,this.b2=this.b0,this.a1=2*-u,this.a2=2*o}},highpass:function(e,t){e/=this.samplerate*.5;if(e>=1)this.b0=this.b1=this.b2=this.a1=this.a2=0;else if(e<=0)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{t=t<0?0:t;var n=Math.pow(10,.05*t),r=Math.sqrt((4-Math.sqrt(16-16/(n*n)))/2),i=Math.PI*e,s=.5*r*Math.sin(i),o=.5*(1-s)/(1+s),u=(.5+o)*Math.cos(i),a=.25*(.5+o+u);this.b0=2*a,this.b1=-4*a,this.b2=this.b0,this.a1=2*-u,this.a2=2*o}},bandpass:function(e,t){e/=this.samplerate*.5;if(e>0&&e<1)if(t>0){var n=Math.PI*e,r=Math.sin(n)/(2*t),i=Math.cos(n),s=1/(1+r);this.b0=r*s,this.b1=0,this.b2=-r*s,this.a1=-2*i*s,this.a2=(1-r)*s}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=this.b1=this.b2=this.a1=this.a2=0},lowshelf:function(e,t,n){e/=this.samplerate*.5;var r=Math.pow(10,n/40);if(e>=1)this.b0=r*r,this.b1=this.b2=this.a1=this.a2=0;else if(e<=0)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else{var i=Math.PI*e,s=1,o=.5*Math.sin(i)*Math.sqrt((r+1/r)*(1/s-1)+2),u=Math.cos(i),a=2*Math.sqrt(r)*o,f=r+1,l=r-1,c=1/(f+l*u+a);this.b0=r*(f-l*u+a)*c,this.b1=2*r*(l-f*u)*c,this.b2=r*(f-l*u-a)*c,this.a1=-2*(l+f*u)*c,this.a2=(f+l*u-a)*c}},highshelf:function(e,t,n){e/=this.samplerate*.5;var r=Math.pow(10,n/40);if(e>=1)this.b0=1,this.b1=this.b2=this.a1=this.a2=0;else if(e<=0)this.b0=r*r,this.b1=this.b2=this.a1=this.a2=0;else{var i=Math.PI*e,s=1,o=.5*Math.sin(i)*Math.sqrt((r+1/r)*(1/s-1)+2),u=Math.cos(i),a=2*Math.sqrt(r)*o,f=r+1,l=r-1,c=1/(f-l*u+a);this.b0=r*(f+l*u+a)*c,this.b1=-2*r*(l+f*u)*c,this.b2=r*(f+l*u-a)*c,this.a1=2*(l-f*u)*c,this.a2=(f-l*u-a)*c}},peaking:function(e,t,n){e/=this.samplerate*.5;if(e>0&&e<1){var r=Math.pow(10,n/40);if(t>0){var i=Math.PI*e,s=Math.sin(i)/(2*t),o=Math.cos(i),u=1/(1+s/r);this.b0=(1+s*r)*u,this.b1=-2*o*u,this.b2=(1-s*r)*u,this.a1=this.b1,this.a2=(1-s/r)*u}else this.b0=r*r,this.b1=this.b2=this.a1=this.a2=0}else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},notch:function(e,t){e/=this.samplerate*.5;if(e>0&&e<1)if(t>0){var n=Math.PI*e,r=Math.sin(n)/(2*t),i=Math.cos(n),s=1/(1+r);this.b0=s,this.b1=-2*i*s,this.b2=s,this.a1=this.b1,this.a2=(1-r)*s}else this.b0=this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0},allpass:function(e,t){e/=this.samplerate*.5;if(e>0&&e<1)if(t>0){var n=Math.PI*e,r=Math.sin(n)/(2*t),i=Math.cos(n),s=1/(1+r);this.b0=(1-r)*s,this.b1=-2*i*s,this.b2=(1+r)*s,this.a1=this.b1,this.a2=this.b0}else this.b0=-1,this.b1=this.b2=this.a1=this.a2=0;else this.b0=1,this.b1=this.b2=this.a1=this.a2=0}};r.lpf=r.lowpass,r.hpf=r.highpass,r.bpf=r.bandpass,r.bef=r.notch,r.brf=r.notch,r.apf=r.allpass,e.modules.Biquad=t}(timbre),function(e){function t(t){this.samplerate=t;var n=Math.round(Math.log(t*.1)*Math.LOG2E);this.buffersize=1<<n,this.bufferL=new e.fn.SignalArray(this.buffersize+1),this.bufferR=new e.fn.SignalArray(this.buffersize+1),this.wave=null,this._wave=null,this.writeIndex=this.buffersize>>1,this.readIndex=0,this.delayTime=20,this.rate=4,this.depth=20,this.feedback=.2,this.wet=.5,this.phase=0,this.phaseIncr=0,this.phaseStep=4,this.setWaveType("sin"),this.setDelayTime(this.delayTime),this.setRate(this.rate)}var n=t.prototype,r=[];r[0]=function(){var e=new Float32Array(512);for(var t=0;t<512;++t)e[t]=Math.sin(2*Math.PI*(t/512));return e}(),r[1]=function(){var e=new Float32Array(512);for(var t,n=0;n<512;++n)t=n/512-.25,e[n]=1-4*Math.abs(Math.round(t)-t);return e}(),n.setWaveType=function(e){e==="sin"?(this.wave=e,this._wave=r[0]):e==="tri"&&(this.wave=e,this._wave=r[1])},n.setDelayTime=function(e){this.delayTime=e;var t=this.writeIndex-(e*this.samplerate*.001|0);while(t<0)t+=this.buffersize;this.readIndex=t},n.setRate=function(e){this.rate=e,this.phaseIncr=512*this.rate/this.samplerate*this.phaseStep},n.process=function(e,t){var n=this.bufferL,r=this.bufferR,i=this.buffersize,s=i-1,o=this._wave,u=this.phase,a=this.phaseIncr,f=this.writeIndex,l=this.readIndex,c=this.depth,h=this.feedback,p,d,v,m=this.wet,g=1-m,y,b=e.length,w,E=this.phaseStep;for(y=0;y<b;){v=o[u|0]*c,u+=a;while(u>512)u-=512;for(w=0;w<E;++w,++y)d=l+i+v&s,p=(n[d]+n[d+1])*.5,n[f]=e[y]-p*h,e[y]=e[y]*g+p*m,p=(r[d]+r[d+1])*.5,r[f]=t[y]-p*h,t[y]=t[y]*g+p*m,f=f+1&s,l=l+1&s}this.phase=u,this.writeIndex=f,this.readIndex=l},e.modules.Chorus=t}(timbre),function(e){function s(n,i){this.samplerate=n,this.channels=i,this.lastPreDelayFrames=0,this.preDelayReadIndex=0,this.preDelayWriteIndex=r,this.ratio=-1,this.slope=-1,this.linearThreshold=-1,this.dbThreshold=-1,this.dbKnee=-1,this.kneeThreshold=-1,this.kneeThresholdDb=-1,this.ykneeThresholdDb=-1,this.K=-1,this.attackTime=.003,this.releaseTime=.25,this.preDelayTime=.006,this.dbPostGain=0,this.effectBlend=1,this.releaseZone1=.09,this.releaseZone2=.16,this.releaseZone3=.42,this.releaseZone4=.98,this.detectorAverage=0,this.compressorGain=1,this.meteringGain=1,this.delayBufferL=new e.fn.SignalArray(t),i===2?this.delayBufferR=new e.fn.SignalArray(t):this.delayBufferR=this.delayBufferL,this.preDelayTime=6,this.preDelayReadIndex=0,this.preDelayWriteIndex=r,this.maxAttackCompressionDiffDb=-1,this.meteringReleaseK=1-Math.exp(-1/(this.samplerate*.325)),this.setAttackTime(this.attackTime),this.setReleaseTime(this.releaseTime),this.setPreDelayTime(this.preDelayTime),this.setParams(-24,30,12)}var t=1024,n=t-1,r=256,i=5,o=s.prototype;o.clone=function(){var e=new s(this.samplerate,this.channels);return e.setAttackTime(this.attackTime),e.setReleaseTime(this.releaseTime),e.setPreDelayTime(this.preDelayTime),e.setParams(this.dbThreshold,this.dbKnee,this.ratio),e},o.setAttackTime=function(e){this.attackTime=Math.max(.001,e),this._attackFrames=this.attackTime*this.samplerate},o.setReleaseTime=function(e){this.releaseTime=Math.max(.001,e);var t=this.releaseTime*this.samplerate,n=.0025;this._satReleaseFrames=n*this.samplerate;var r=t*this.releaseZone1,i=t*this.releaseZone2,s=t*this.releaseZone3,o=t*this.releaseZone4;this._kA=.9999999999999998*r+1.8432219684323923e-16*i-1.9373394351676423e-16*s+8.824516011816245e-18*o,this._kB=-1.5788320352845888*r+2.3305837032074286*i-.9141194204840429*s+.1623677525612032*o,this._kC=.5334142869106424*r-1.272736789213631*i+.9258856042207512*s-.18656310191776226*o,this._kD=.08783463138207234*r-.1694162967925622*i+.08588057951595272*s-.00429891410546283*o,this._kE=-0.042416883008123074*r+.1115693827987602*i-.09764676325265872*s+.028494263462021576*o},o.setPreDelayTime=function(e){this.preDelayTime=e;var n=e*this.samplerate;n>t-1&&(n=t-1);if(this.lastPreDelayFrames!==n){this.lastPreDelayFrames=n;for(var r=0,i=this.delayBufferL.length;r<i;++r)this.delayBufferL[r]=this.delayBufferR[r]=0;this.preDelayReadIndex=0,this.preDelayWriteIndex=n}},o.setParams=function(e,t,n){this._k=this.updateStaticCurveParameters(e,t,n);var r=this.saturate(1,this._k),i=1/r;i=Math.pow(i,.6),this._masterLinearGain=Math.pow(10,.05*this.dbPostGain)*i},o.kneeCurve=function(e,t){return e<this.linearThreshold?e:this.linearThreshold+(1-Math.exp(-t*(e-this.linearThreshold)))/t},o.saturate=function(e,t){var n;if(e<this.kneeThreshold)n=this.kneeCurve(e,t);else{var r=e?20*Math.log(e)*Math.LOG10E:-1e3,i=this.ykneeThresholdDb+this.slope*(r-this.kneeThresholdDb);n=Math.pow(10,.05*i)}return n},o.slopeAt=function(e,t){if(e<this.linearThreshold)return 1;var n=e*1.001,r=e?20*Math.log(e)*Math.LOG10E:-1e3,i=n?20*Math.log(n)*Math.LOG10E:-1e3,s=this.kneeCurve(e,t),o=this.kneeCurve(n,t),u=s?20*Math.log(s)*Math.LOG10E:-1e3,a=o?20*Math.log(o)*Math.LOG10E:-1e3;return(a-u)/(i-r)},o.kAtSlope=function(e){var t=this.dbThreshold+this.dbKnee,n=Math.pow(10,.05*t),r=.1,i=1e4,s=5;for(var o=0;o<15;++o){var u=this.slopeAt(n,s);u<e?i=s:r=s,s=Math.sqrt(r*i)}return s},o.updateStaticCurveParameters=function(e,t,n){this.dbThreshold=e,this.linearThreshold=Math.pow(10,.05*e),this.dbKnee=t,this.ratio=n,this.slope=1/this.ratio,this.kneeThresholdDb=e+t,this.kneeThreshold=Math.pow(10,.05*this.kneeThresholdDb);var r=this.kAtSlope(1/this.ratio),i=this.kneeCurve(this.kneeThreshold,r);return this.ykneeThresholdDb=i?20*Math.log(i)*Math.LOG10E:-1e3,this._k=r,this._k},o.process=function(e,t){var r=1-this.effectBlend,s=this.effectBlend,o=this._k,u=this._masterLinearGain,a=this._satReleaseFrames,f=this._kA,l=this._kB,c=this._kC,h=this._kD,p=this._kE,d=64,v=e.length/d,m=0,g=this.detectorAverage,y=this.compressorGain,b=this.maxAttackCompressionDiffDb,w=1/this._attackFrames,E=this.preDelayReadIndex,S=this.preDelayWriteIndex,x=this.detectorAverage,T=this.delayBufferL,N=this.delayBufferR,C=this.meteringGain,k=this.meteringReleaseK;for(var L=0;L<v;++L){var A=Math.asin(g)/(.5*Math.PI),O,M=A>y,_=y/A,D=_?20*Math.log(_)*Math.LOG10E:-1e3;if(D===Infinity||isNaN(D))D=-1;if(M){b=-1,_=D,_<-12?_=0:_>0?_=3:_=.25*(_+12);var P=_*_,H=P*_,B=P*P,j=f+l*_+c*P+h*H+p*B,F=i/j;O=Math.pow(10,.05*F)}else{if(b===-1||b<D)b=D;var I=Math.max(.5,b);_=.25/I,O=1-Math.pow(_,w)}var q=d;while(q--){var R=0,U=(e[m]+t[m])*.5;T[S]=e[m],N[S]=t[m],U<0&&(U*=-1),R<U&&(R=U);var z=R;z<0&&(z*=-1);var W=this.saturate(z,o),X=z<=1e-4?1:W/z,V=X?-20*Math.log(X)*Math.LOG10E:1e3;V<2&&(V=2);var $=V/a,J=Math.pow(10,.05*$)-1,K=X>x,Q=K?J:1;x+=(X-x)*Q,x>1&&(x=1),O<1?y+=(A-y)*O:(y*=O,y>1&&(y=1));var G=Math.sin(.5*Math.PI*y),Y=r+s*u*G,Z=20*Math.log(G)*Math.LOG10E;Z<C?C=Z:C+=(Z-C)*k,e[m]=T[E]*Y,t[m]=N[E]*Y,m++,E=E+1&n,S=S+1&n}x<1e-6&&(x=1e-6),y<1e-6&&(y=1e-6)}this.preDelayReadIndex=E,this.preDelayWriteIndex=S,this.detectorAverage=x,this.compressorGain=y,this.maxAttackCompressionDiffDb=b,this.meteringGain=C},o.reset=function(){this.detectorAverage=0,this.compressorGain=1,this.meteringGain=1;for(var e=0,t=this.delayBufferL.length;e<t;++e)this.delayBufferL[e]=this.delayBufferR[e]=0;this.preDelayReadIndex=0,this.preDelayWriteIndex=r,this.maxAttackCompressionDiffDb=-1},e.modules.Compressor=s}(timbre),function(e){function t(){}t.prototype.decode=function(e,n,r){if(typeof e=="string"){if(/\.wav$/.test(e))return t.wav_decode(e,n,r);if(t.ogg_decode&&/\.ogg$/.test(e))return t.ogg_decode(e,n,r);if(t.mp3_decode&&/\.mp3$/.test(e))return t.mp3_decode(e,n,r)}else if(typeof e=="object"){if(e.type==="wav")return t.wav_decode(e.data,n,r);if(t.ogg_decode&&e.type==="ogg")return t.ogg_decode(e.data,n,r);if(t.mp3_decode&&e.type==="mp3")return t.mp3_decode(e.data,n,r)}if(t.webkit_decode)return typeof e=="object"?t.webkit_decode(e.data||e,n,r):t.webkit_decode(e,n,r);if(t.moz_decode)return t.moz_decode(e,n,r);n(!1)},e.modules.Decoder=t,e.envtype==="browser"?t.getBinaryWithPath=function(t,n){e.fn.fix_iOS6_1_problem(!0);var r=new XMLHttpRequest;r.open("GET",t),r.responseType="arraybuffer",r.onreadystatechange=function(){r.readyState===4&&(r.response?n(new Uint8Array(r.response)):r.responseBody!==undefined&&n(new Uint8Array(VBArray(r.responseBody).toArray())),e.fn.fix_iOS6_1_problem(!1))},r.send()}:t.getBinaryWithPath=function(e,t){t("no support")};var n=function(e){var t,n,r,i,s,o=new Int32Array(e.length/3);for(var u=0,a=e.length,f=0;u<a;)t=e[u++],n=e[u++],r=e[u++],i=t+(n<<8)+(r<<16),s=i&8388608?i-16777216:i,o[f++]=s;return o};t.wav_decode=function(){var e=function(e,t,r){if(String.fromCharCode(e[0],e[1],e[2],e[3])!=="RIFF")return t(!1);var i=e[4]+(e[5]<<8)+(e[6]<<16)+(e[7]<<24);if(i+8!==e.length)return t(!1);if(String.fromCharCode(e[8],e[9],e[10],e[11])!=="WAVE")return t(!1);if(String.fromCharCode(e[12],e[13],e[14],e[15])!=="fmt ")return t(!1);var s=e[22]+(e[23]<<8),o=e[24]+(e[25]<<8)+(e[26]<<16)+(e[27]<<24),u=e[34]+(e[35]<<8),a=36;while(a<e.length){if(String.fromCharCode(e[a],e[a+1],e[a+2],e[a+3])==="data")break;a+=1}if(a>=e.length)return t(!1);a+=4;var f=e[a]+(e[a+1]<<8)+(e[a+2]<<16)+(e[a+3]<<24),l=(f/s>>1)/o;a+=4;if(f>e.length-a)return t(!1);var c,h,p;c=new Float32Array(l*o|0),s===2&&(h=new Float32Array(c.length),p=new Float32Array(c.length)),t({samplerate:o,channels:s,buffer:[c,h,p],duration:l}),u===8?e=new Int8Array(e.buffer,a):u===16?e=new Int16Array(e.buffer,a):u===32?e=new Int32Array(e.buffer,a):u===24&&(e=n(new Uint8Array(e.buffer,a)));var d,v,m=1/((1<<u-1)-1),g;if(s===2)for(a=v=0,d=c.length;a<d;++a)g=h[a]=e[v++]*m,g+=p[a]=e[v++]*m,c[a]=g*.5;else for(a=0,d=c.length;a<d;++a)c[a]=e[a]*m;r()};return function(n,r,i){typeof n=="string"?t.getBinaryWithPath(n,function(t){e(t,r,i)}):e(n,r,i)}}(),t.webkit_decode=function(){if(typeof webkitAudioContext!="undefined"){var n=e.fn._audioContext,r=function(e,t,r){var i,s,o,u,a;if(typeof e=="string")return r(!1);var f;try{f=n.createBuffer(e.buffer,!1)}catch(l){return t(!1)}i=n.sampleRate,s=f.numberOfChannels,s===2?(o=f.getChannelData(0),u=f.getChannelData(1)):o=u=f.getChannelData(0),a=o.length/i;var c=new Float32Array(o);for(var h=0,p=c.length;h<p;++h)c[h]=(c[h]+u[h])*.5;t({samplerate:i,channels:s,buffer:[c,o,u],duration:a}),r()};return function(e,n,i){if(e instanceof File){var s=new FileReader;s.onload=function(e){r(new Uint8Array(e.target.result),n,i)},s.readAsArrayBuffer(e)}else typeof e=="string"?t.getBinaryWithPath(e,function(e){r(e,n,i)}):r(e,n,i)}}}(),t.moz_decode=function(){if(typeof Audio=="function"&&typeof (new Audio).mozSetup=="function")return function(e,t,n){var r,i,s,o,u,a,f=0,l=new Audio(e);l.volume=0,l.addEventListener("loadedmetadata",function(){r=l.mozSampleRate,i=l.mozChannels,a=l.duration,s=new Float32Array(l.duration*r|0),i===2&&(o=new Float32Array(l.duration*r|0),u=new Float32Array(l.duration*r|0)),i===2?l.addEventListener("MozAudioAvailable",function(e){var t,n=e.frameBuffer;for(var r=0,i=n.length;r<i;r+=2)t=o[f]=n[r],t+=u[f]=n[r+1],s[f]=t*.5,f+=1},!1):l.addEventListener("MozAudioAvailable",function(e){var t=e.frameBuffer;for(var n=0,r=t.length;n<r;++n)s[n]=t[n],f+=1},!1),l.play(),setTimeout(function(){t({samplerate:r,channels:i,buffer:[s,o,u],duration:a})},1e3)},!1),l.addEventListener("ended",function(){n()},!1),l.load()}}()}(timbre),function(e){function t(e){this.samplerate=e||44100,this.value=n,this.status=c,this.curve="linear",this.step=1,this.releaseNode=null,this.loopNode=null,this.emit=null,this._envValue=new y(e),this._table=[],this._initValue=n,this._curveValue=0,this._defaultCurveType=i,this._index=0,this._counter=0}function y(e){this.samplerate=e,this.value=n,this.step=1,this._curveType=i,this._curveValue=0,this._grow=0,this._a2=0,this._b1=0,this._y1=0,this._y2=0}var n=t.ZERO=1e-6,r=t.CurveTypeSet=0,i=t.CurveTypeLin=1,s=t.CurveTypeExp=2,o=t.CurveTypeSin=3,u=t.CurveTypeWel=4,a=t.CurveTypeCurve=5,f=t.CurveTypeSqr=6,l=t.CurveTypeCub=7,c=t.StatusWait=0,h=t.StatusGate=1,p=t.StatusSustain=2,d=t.StatusRelease=3,v=t.StatusEnd=4,m={set:r,lin:i,linear:i,exp:s,exponential:s,sin:o,sine:o,wel:u,welch:u,sqr:f,squared:f,cub:l,cubed:l};t.CurveTypeDict=m;var g=t.prototype;g.clone=function(){var e=new t(this.samplerate);return e._table=this._table,e._initValue=this._initValue,e.setCurve(this.curve),this.releaseNode!==null&&e.setReleaseNode(this.releaseNode+1),this.loopNode!==null&&e.setLoopNode(this.loopNode+1),e.setStep(this.step),e.reset(),e},g.setTable=function(e){this._initValue=e[0],this._table=e.slice(1),this.value=this._envValue.value=this._initValue,this._index=0,this._counter=0,this.status=c},g.setCurve=function(e){typeof e=="number"?(this._defaultCurveType=a,this._curveValue=e,this.curve=e):(this._defaultCurveType=m[e]||null,this.curve=e)},g.setReleaseNode=function(e){typeof e=="number"&&e>0&&(this.releaseNode=e-1)},g.setLoopNode=function(e){typeof e=="number"&&e>0&&(this.loopNode=e-1)},g.setStep=function(e){this.step=this._envValue.step=e},g.reset=function(){this.value=this._envValue.value=this._initValue,this._index=0,this._counter=0,this.status=c},g.release=function(){this.releaseNode!==null&&(this._counter=0,this.status=d)},g.getInfo=function(e){var t=this._table,n,r,i=0,s=Infinity,o=Infinity,u=!1;for(n=0,r=t.length;n<r;++n){this.loopNode===n&&(s=i),this.releaseNode===n&&(i<e?i+=e:i=e,o=i);var a=t[n];Array.isArray(a)&&(i+=a[1])}return s!==Infinity&&o===Infinity&&(i+=e,u=!0),{totalDuration:i,loopBeginTime:s,releaseBeginTime:o,isEndlessLoop:u}},g.calcStatus=function(){var e=this.status,t=this._table,n=this._index,s=this._counter,o=this._curveValue,u=this._defaultCurveType,f=this.loopNode,l=this.releaseNode,m=this._envValue,g,y,b,w,E=null;switch(e){case c:case v:break;case h:case d:while(s<=0){if(n>=t.length){if(e===h&&f!==null){n=f;continue}e=v,s=Infinity,w=r,E="ended";continue}if(e===h&&n===l){if(f!==null&&f<l){n=f;continue}e=p,s=Infinity,w=r,E="sustained";continue}g=t[n++],y=g[0],g[2]===null?w=u:w=g[2],w===a&&(o=g[3],Math.abs(o)<.001&&(w=i)),b=g[1],s=m.setNext(y,b,w,o)}}return this.status=e,this.emit=E,this._index=n,this._counter=s,e},g.next=function(){return this.calcStatus()&1&&(this.value=this._envValue.next()||n),this._counter-=1,this.value},g.process=function(e){var t=this._envValue,r,i=e.length;if(this.calcStatus()&1)for(r=0;r<i;++r)e[r]=t.next()||n;else{var s=this.value||n;for(r=0;r<i;++r)e[r]=s}this.value=e[i-1],this._counter-=e.length},y.prototype.setNext=function(e,t,n,c){var h=this.step,p=this.value,d,v,m,g,y,w,E,S=t*.001*this.samplerate/h|0;S<1&&(S=1,n=r);switch(n){case r:this.value=e;break;case i:d=(e-p)/S;break;case s:p!==0?d=Math.pow(e/p,1/S):d=0;break;case o:v=Math.PI/S,g=(e+p)*.5,y=2*Math.cos(v),w=(e-p)*.5,E=w*Math.sin(Math.PI*.5-v),p=g-w;break;case u:v=Math.PI*.5/S,y=2*Math.cos(v),e>=p?(g=p,w=0,E=-Math.sin(v)*(e-p)):(g=e,w=p-e,E=Math.cos(v)*(p-e)),p=g+w;break;case a:m=(e-p)/(1-Math.exp(c)),g=p+m,y=m,d=Math.exp(c/S);break;case f:w=Math.sqrt(p),E=Math.sqrt(e),d=(E-w)/S;break;case l:w=Math.pow(p,.33333333),E=Math.pow(e,.33333333),d=(E-w)/S}return this.next=b[n],this._grow=d,this._a2=g,this._b1=y,this._y1=w,this._y2=E,S};var b=[];b[r]=function(){return this.value},b[i]=function(){return this.value+=this._grow,this.value},b[s]=function(){return this.value*=this._grow,this.value},b[o]=function(){var e=this._b1*this._y1-this._y2;return this.value=this._a2-e,this._y2=this._y1,this._y1=e,this.value},b[u]=function(){var e=this._b1*this._y1-this._y2;return this.value=this._a2+e,this._y2=this._y1,this._y1=e,this.value},b[a]=function(){return this._b1*=this._grow,this.value=this._a2-this._b1,this.value},b[f]=function(){return this._y1+=this._grow,this.value=this._y1*this._y1,this.value},b[l]=function(){return this._y1+=this._grow,this.value=this._y1*this._y1*this._y1,this.value},y.prototype.next=b[r],e.modules.Envelope=t,e.modules.EnvelopeValue=y}(timbre),function(e){function t(t){t=typeof t=="number"?t:512,t=1<<Math.ceil(Math.log(t)*Math.LOG2E),this.length=t,this.buffer=new e.fn.SignalArray(t),this.real=new e.fn.SignalArray(t),this.imag=new e.fn.SignalArray(t),this._real=new e.fn.SignalArray(t),this._imag=new e.fn.SignalArray(t),this.mag=new e.fn.SignalArray(t>>1),this.minDecibels=-30,this.maxDecibels=-100;var n=r.get(t);this._bitrev=n.bitrev,this._sintable=n.sintable,this._costable=n.costable}var n=t.prototype;n.setWindow=function(t){if(typeof t=="string"){var n=/([A-Za-z]+)(?:\(([01]\.?\d*)\))?/.exec(t);if(n!==null){var r=n[1].toLowerCase(),s=n[2]!==undefined?+n[2]:.25,o=i[r];if(o){this._window||(this._window=new e.fn.SignalArray(this.length));var u=this._window,a=0,f=this.length;s=s<0?0:s>1?1:s;for(;a<f;++a)u[a]=o(a,f,s);this.windowName=t}}}},n.forward=function(e){var t=this.buffer,n=this.real,r=this.imag,i=this._window,s=this._bitrev,o=this._sintable,u=this._costable,a=t.length,f,l,c,h,p,d,v,m,g,y,b;if(i)for(f=0;f<a;++f)t[f]=e[f]*i[f];else t.set(e);for(f=0;f<a;++f)n[f]=t[s[f]],r[f]=0;for(c=1;c<a;c=h){p=0,h=c+c,d=a/h;for(l=0;l<c;l++){v=u[p],m=o[p];for(f=l;f<a;f+=h)g=f+c,y=m*r[g]+v*n[g],b=v*r[g]-m*n[g],n[g]=n[f]-y,n[f]+=y,r[g]=r[f]-b,r[f]+=b;p+=d}}var w=this.mag,E,S;for(f=0;f<a;++f)E=n[f],S=r[f],w[f]=Math.sqrt(E*E+S*S);return{real:n,imag:r}},n.inverse=function(e,t){var n=this.buffer,r=this._real,i=this._imag,s=this._bitrev,o=this._sintable,u=this._costable,a=n.length,f,l,c,h,p,d,v,m,g,y,b;for(f=0;f<a;++f)l=s[f],r[f]=+e[l],i[f]=-t[l];for(c=1;c<a;c=h){p=0,h=c+c,d=a/h;for(l=0;l<c;l++){v=u[p],m=o[p];for(f=l;f<a;f+=h)g=f+c,y=m*i[g]+v*r[g],b=v*i[g]-m*r[g],r[g]=r[f]-y,r[f]+=y,i[g]=i[f]-b,i[f]+=b;p+=d}}for(f=0;f<a;++f)n[f]=r[f]/a;return n},n.getFrequencyData=function(e){var t=this.minDecibels,n,r=Math.min(this.mag.length,e.length);if(r){var i,s=this.mag,o=0;for(n=0;n<r;++n)i=s[n],e[n]=i?20*Math.log(i)*Math.LOG10E:t,o<e[n]&&(o=e[n])}return e};var r={get:function(t){return r[t]||function(){var n=function(){var e,n,r,i,s;e=new Int16Array(t),s=t>>1,n=r=0;for(;;){e[n]=r;if(++n>=t)break;i=s;while(i<=r)r-=i,i>>=1;r+=i}return e}(),i,s,o=Math.floor(Math.log(t)/Math.LN2),u=new e.fn.SignalArray((1<<o)-1),a=new e.fn.SignalArray((1<<o)-1),f=Math.PI*2;for(i=0,s=u.length;i<s;++i)u[i]=Math.sin(f*(i/t)),a[i]=Math.cos(f*(i/t));return r[t]={bitrev:n,sintable:u,costable:a},r[t]}()}},i=function(){var e=Math.PI,t=Math.PI*2,n=Math.abs,r=Math.pow,i=Math.cos,s=Math.sin,o=function(t){return s(e*t)/(e*t)},u=Math.E;return{rectangular:function(){return 1},hann:function(e,n){return.5*(1-i(t*e/(n-1)))},hamming:function(e,n){return.54-.46*i(t*e/(n-1))},tukery:function(t,n,r){return t<r*(n-1)/2?.5*(1+i(e*(2*t/(r*(n-1))-1))):(n-1)*(1-r/2)<t?.5*(1+i(e*(2*t/(r*(n-1))-2/r+1))):1},cosine:function(t,n){return s(e*t/(n-1))},lanczos:function(e,t){return o(2*e/(t-1)-1)},triangular:function(e,t){return 2/(t+1)*((t+1)/2-n(e-(t-1)/2))},bartlett:function(e,t){return 2/(t-1)*((t-1)/2-n(e-(t-1)/2))},gaussian:function(e,t,n){return r(u,-0.5*r((e-(t-1)/2)/(n*(t-1)/2),2))},bartlettHann:function(e,r){return.62-.48*n(e/(r-1)-.5)-.38*i(t*e/(r-1))},blackman:function(n,r,s){var o=(1-s)/2,u=.5,a=s/2;return o-u*i(t*n/(r-1))+a*i(4*e*n/(r-1))}}}();e.modules.FFT=t}(timbre),function(e){function t(e){this.samplerate=e||44100,this.wave=null,this.step=1,this.frequency=0,this.value=0,this.phase=0,this.feedback=!1,this._x=0,this._lastouts=0,this._coeff=n/this.samplerate,this._radtoinc=n/(Math.PI*2)}function s(e,t,n,r){var i=l[t],s,o,u,a,f;if(i===undefined)return;typeof i=="function"&&(i=i());switch(n){case"@1":for(o=512;o<1024;++o)i[o]=0;break;case"@2":for(o=512;o<1024;++o)i[o]=Math.abs(i[o]);break;case"@3":for(o=256;o<512;++o)i[o]=0;for(o=512;o<768;++o)i[o]=Math.abs(i[o]);for(o=768;o<1024;++o)i[o]=0;break;case"@4":s=new Float32Array(1024);for(o=0;o<512;++o)s[o]=i[o<<1];i=s;break;case"@5":s=new Float32Array(1024);for(o=0;o<512;++o)s[o]=Math.abs(i[o<<1]);i=s}if(r!==undefined&&r!==50){r*=.01,r=r<0?0:r>1?1:r,s=new Float32Array(1024),u=1024*r|0;for(o=0;o<u;++o)s[o]=i[o/u*512|0];f=1024-u;for(a=0;o<1024;++o,++a)s[o]=i[a/f*512+512|0];i=s}if(e==="+")for(o=0;o<1024;++o)i[o]=i[o]*.5+.5;else if(e==="-")for(o=0;o<1024;++o)i[o]*=-1;return i}function o(e){var t=new Float32Array(1024),n=e.length>>1;if([2,4,8,16,32,64,128,256,512,1024].indexOf(n)!==-1)for(var r=0,i=0;r<n;++r){var s=parseInt(e.substr(r*2,2),16);s=s&128?(s-256)/128:s/127;for(var o=0,u=1024/n;o<u;++o)t[i++]=s}return t}function u(e){var t=new Float32Array(1024);if(e.length===8){var n=parseInt(e,16),r=new Float32Array(8),i,s;r[0]=1;for(i=0;i<7;++i)r[i+1]=(n&15)*.0625,n>>=4;for(i=0;i<8;++i){var o=0,u=(i+1)/1024;for(s=0;s<1024;++s)t[s]+=Math.sin(2*Math.PI*o)*r[i],o+=u}var a=0,f;for(i=0;i<1024;++i)a<(f=Math.abs(t[i]))&&(a=f);if(a>0)for(i=0;i<1024;++i)t[i]/=a}return t}var n=1024,r=n-1,i=t.prototype;i.setWave=function(t){var r,i,s=this.wave;this.wave||(this.wave=new Float32Array(n+1));if(typeof t=="function")for(r=0;r<n;++r)s[r]=t(r/n);else if(e.fn.isSignalArray(t))if(t.length===s.length)s.set(t);else{i=t.length/n;for(r=0;r<n;++r)s[r]=t[r*i|0]}else typeof t=="string"&&(i=a(t))!==undefined&&this.wave.set(i);this.wave[n]=this.wave[0]},i.clone=function(){var e=new t(this.samplerate);return e.wave=this.wave,e.step=this.step,e.frequency=this.frequency,e.value=this.value,e.phase=this.phase,e.feedback=this.feedback,e},i.reset=function(){this._x=0},i.next=function(){var e=this._x,t=e+this.phase*this._radtoinc|0;return this.value=this.wave[t&r],e+=this.frequency*this._coeff*this.step,e>n&&(e-=n),this._x=e,this.value},i.process=function(e){var t=this.wave,i=this._radtoinc,s,o=this._x,u,a,f,l,c=this.frequency*this._coeff,h,p=this.step;if(this.feedback){var d=this._lastouts;i*=this.phase;for(h=0;h<p;++h)s=o+d*i,u=s|0,a=s-u,u&=r,f=t[u],l=t[u+1],e[h]=d=f+a*(l-f),o+=c;this._lastouts=d}else{var v=this.phase*i;for(h=0;h<p;++h)s=o+v,u=s|0,a=s-u,u&=r,f=t[u],l=t[u+1],e[h]=f+a*(l-f),o+=c}o>n&&(o-=n),this._x=o,this.value=e[e.length-1]},i.processWithFreqArray=function(e,t){var i=this.wave,s=this._radtoinc,o,u=this._x,a,f,l,c,h=this._coeff,p,d=this.step;if(this.feedback){var v=this._lastouts;s*=this.phase;for(p=0;p<d;++p)o=u+v*s,a=o|0,f=o-a,a&=r,l=i[a],c=i[a+1],e[p]=v=l+f*(c-l),u+=t[p]*h;this._lastouts=v}else{var m=this.phase*this._radtoinc;for(p=0;p<d;++p)o=u+m,a=o|0,f=o-a,a&=r,l=i[a],c=i[a+1],e[p]=l+f*(c-l),u+=t[p]*h}u>n&&(u-=n),this._x=u,this.value=e[e.length-1]},i.processWithPhaseArray=function(e,t){var i=this.wave,s=this._radtoinc,o,u=this._x,a,f,l,c,h=this.frequency*this._coeff,p,d=this.step;if(this.feedback){var v=this._lastouts;s*=this.phase;for(p=0;p<d;++p)o=u+v*s,a=o|0,f=o-a,a&=r,l=i[a],c=i[a+1],e[p]=v=l+f*(c-l),u+=h;this._lastouts=v}else for(p=0;p<d;++p)o=u+t[p]*s,a=o|0,f=o-a,a&=r,l=i[a],c=i[a+1],e[p]=l+f*(c-l),u+=h;u>n&&(u-=n),this._x=u,this.value=e[e.length-1]},i.processWithFreqAndPhaseArray=function(e,t,i){var s=this.wave,o=this._radtoinc,u,a=this._x,f,l,c,h,p=this._coeff,d,v=this.step;if(this.feedback){var m=this._lastouts;o*=this.phase;for(d=0;d<v;++d)u=a+m*o,f=u|0,l=u-f,f&=r,c=s[f],h=s[f+1],e[d]=m=c+l*(h-c),a+=t[d]*p;this._lastouts=m}else for(d=0;d<v;++d)u=a+i[d]*n,f=u|0,l=u-f,f&=r,c=s[f],h=s[f+1],e[d]=c+l*(h-c),a+=t[d]*p;a>n&&(a-=n),this._x=a,this.value=e[e.length-1]};var a=function(e){var t=l[e];if(t!==undefined)return typeof t=="function"&&(t=t()),t;var n;n=/^([\-+]?)(\w+)(?:\((@[0-7])?:?(\d+)?\))?$/.exec(e);if(n!==null){var r=n[1],i=n[2],a=n[3],f=n[4];t=s(r,i,a,f);if(t!==undefined)return l[e]=t,t}n=/^wavb\(((?:[0-9a-fA-F][0-9a-fA-F])+)\)$/.exec(e);if(n!==null)return o(n[1]);n=/^wavc\(([0-9a-fA-F]{8})\)$/.exec(e);if(n!==null)return u(n[1])};t.getWavetable=a;var f=function(t,n){var r,i=new Float32Array(1024),s;if(typeof n=="function")for(s=0;s<1024;++s)i[s]=n(s/1024);else if(e.fn.isSignalArray(n))if(n.length===i.length)i.set(n);else{r=n.length/1024;for(s=0;s<1024;++s)i[s]=n[s*r|0]}l[t]=i};t.setWavetable=f;var l={sin:function(){var e=new Float32Array(1024);for(var t=0;t<1024;++t)e[t]=Math.sin(2*Math.PI*(t/1024));return e},cos:function(){var e=new Float32Array(1024);for(var t=0;t<1024;++t)e[t]=Math.cos(2*Math.PI*(t/1024));return e},pulse:function(){var e=new Float32Array(1024);for(var t=0;t<1024;++t)e[t]=t<512?1:-1;return e},tri:function(){var e=new Float32Array(1024);for(var t,n=0;n<1024;++n)t=n/1024-.25,e[n]=1-4*Math.abs(Math.round(t)-t);return e},saw:function(){var e=new Float32Array(1024);for(var t,n=0;n<1024;++n)t=n/1024,e[n]=2*(t-Math.round(t));return e},fami:function(){var e=[0,.125,.25,.375,.5,.625,.75,.875,.875,.75,.625,.5,.375,.25,.125,0,-0.125,-0.25,-0.375,-0.5,-0.625,-0.75,-0.875,-1,-1,-0.875,-0.75,-0.625,-0.5,-0.375,-0.25,-0.125],t=new Float32Array(1024);for(var n=0;n<1024;++n)t[n]=e[n/1024*e.length|0];return t},konami:function(){var e=[-0.625,-0.875,-0.125,.75,.5,.125,.5,.75,.25,-0.125,.5,.875,.625,0,.25,.375,-0.125,-0.75,0,.625,.125,-0.5,-0.375,-0.125,-0.75,-1,-0.625,0,-0.375,-0.875,-0.625,-0.25],t=new Float32Array(1024);for(var n=0;n<1024;++n)t[n]=e[n/1024*e.length|0];return t}};e.modules.Oscillator=t}(timbre),function(e){function r(r,i){this.samplerate=r;var u,a,f=r/44100;a=t.length*2,this.comb=new Array(a),this.combout=new Array(a);for(u=0;u<a;++u)this.comb[u]=new s(t[u%t.length]*f),this.combout[u]=new e.fn.SignalArray(i);a=n.length*2,this.allpass=new Array(a);for(u=0;u<a;++u)this.allpass[u]=new o(n[u%n.length]*f);this.outputs=[new e.fn.SignalArray(i),new e.fn.SignalArray(i)],this.damp=0,this.wet=.33,this.setRoomSize(.5),this.setDamp(.5)}function s(t){this.buffer=new e.fn.SignalArray(t|0),this.buffersize=this.buffer.length,this.bufidx=0,this.feedback=0,this.filterstore=0,this.damp=0}function o(t){this.buffer=new e.fn.SignalArray(t|0),this.buffersize=this.buffer.length,this.bufidx=0}var t=[1116,1188,1277,1356,1422,1491,1557,1617],n=[225,556,441,341],i=r.prototype;i.setRoomSize=function(e){var t=this.comb,n=e*.28+.7;this.roomsize=e,t[0].feedback=t[1].feedback=t[2].feedback=t[3].feedback=t[4].feedback=t[5].feedback=t[6].feedback=t[7].feedback=t[8].feedback=t[9].feedback=t[10].feedback=t[11].feedback=t[12].feedback=t[13].feedback=t[14].feedback=t[15].feedback=n},i.setDamp=function(e){var t=this.comb,n=e*.4;this.damp=e,t[0].damp=t[1].damp=t[2].damp=t[3].damp=t[4].damp=t[5].damp=t[6].damp=t[7].damp=t[8].damp=t[9].damp=t[10].damp=t[11].damp=t[12].damp=t[13].damp=t[14].damp=t[15].damp=n},i.process=function(e,t){var n=this.comb,r=this.combout,i=this.allpass,s=this.outputs[0],o=this.outputs[1],u=this.wet,a=1-u,f,l=e.length;n[0].process(e,r[0]),n[1].process(e,r[1]),n[2].process(e,r[2]),n[3].process(e,r[3]),n[4].process(e,r[4]),n[5].process(e,r[5]),n[6].process(e,r[6]),n[7].process(e,r[7]),n[8].process(t,r[8]),n[9].process(t,r[9]),n[10].process(t,r[10]),n[11].process(t,r[11]),n[12].process(t,r[12]),n[13].process(t,r[13]),n[14].process(t,r[14]),n[15].process(t,r[15]);for(f=0;f<l;++f)s[f]=r[0][f]+r[1][f]+r[2][f]+r[3][f]+r[4][f]+r[5][f]+r[6][f]+r[7][f],o[f]=r[8][f]+r[9][f]+r[10][f]+r[11][f]+r[12][f]+r[13][f]+r[14][f]+r[15][f];i[0].process(s,s),i[1].process(s,s),i[2].process(s,s),i[3].process(s,s),i[4].process(o,o),i[5].process(o,o),i[6].process(o,o),i[7].process(o,o);for(f=0;f<l;++f)e[f]=s[f]*u+e[f]*a,t[f]=o[f]*u+t[f]*a},s.prototype.process=function(e,t){var n,r,i=this.buffer,s=this.buffersize,o=this.bufidx,u=this.filterstore,a=this.feedback,f=this.damp,l=1-f,c,h=e.length;for(c=0;c<h;++c)n=e[c]*.015,r=i[o],u=r*l+u*f,i[o]=n+u*a,++o>=s&&(o=0),t[c]=r;this.bufidx=o,this.filterstore=u},o.prototype.process=function(e,t){var n,r,i,s=this.buffer,o=this.buffersize,u=this.bufidx,a,f=e.length;for(a=0;a<f;++a)n=e[a],i=s[u],r=-n+i,s[u]=n+i*.5,++u>=o&&(u=0),t[a]=r;this.bufidx=u},e.modules.Reverb=r}(timbre),function(e){function n(e){return new i(e)}function i(e){this.fragments=[];if(e){var t=e.samplerate||44100,n=e.buffer[0].length/t;this.fragments.push(new s(e,0,n))}}function s(e,t,n,i,s,o,u){e||(e=r),this.buffer=e.buffer[0],this.samplerate=e.samplerate||44100,this.start=t,this._duration=n,this.reverse=i||!1,this.pitch=s||100,this.stretch=o||!1,this.pan=u||50}function o(e,t){this.tape=e,this.fragments=e.fragments,this.samplerate=t||44100,this.isEnded=!1,this.buffer=null,this.bufferIndex=0,this.bufferIndexIncr=0,this.bufferBeginIndex=0,this.bufferEndIndex=0,this.fragment=null,this.fragmentIndex=0,this.panL=.5,this.panR=.5}var t=new Float32Array(60),r={buffer:t,samplerate:1};n.silence=function(e){return(new n(r)).slice(0,1).fill(e)},n.join=function(e){var t=new i;for(var n=0;n<e.length;n++)e[n]instanceof i&&t.add_fragments(e[n].fragments);return t},n.Tape=i,i.prototype.add_fragment=function(e){return this.fragments.push(e),this},i.prototype.add_fragments=function(e){for(var t=0;t<e.length;t++)this.fragments.push(e[t]);return this},i.prototype.duration=function(){var e=0;for(var t=0;t<this.fragments.length;t++)e+=this.fragments[t].duration();return e},i.prototype.slice=function(e,t){var n=this.duration();e+t>n&&(t=n-e);var r=new i,s=e,o=t;for(var u=0;u<this.fragments.length;u++){var a=this.fragments[u],f=a.create(s,o),l=f[0];s=f[1],o=f[2],l&&r.add_fragment(l);if(o===0)break}return r},i.prototype.cut=i.prototype.slice,i.prototype.concat=function(e){var t=new i;return t.add_fragments(this.fragments),t.add_fragments(e.fragments),t},i.prototype.loop=function(e){var t,n=[];for(t=0;t<this.fragments.length;t++)n.push(this.fragments[t].clone());var r=new i;for(t=0;t<e;t++)r.add_fragments(n);return r},i.prototype.times=i.prototype.loop,i.prototype.split=function(e){var t=this.duration()/e,n=[];for(var r=0;r<e;r++)n.push(this.slice(r*t,t));return n},i.prototype.fill=function(e){var t=this.duration();if(t===0)throw"EmptyFragment";var n=e/t|0,r=e%t;return this.loop(n).plus(this.slice(0,r))},i.prototype.replace=function(e,t,r){var s=new i,o=e+t;s=s.plus(this.slice(0,e));var u=s.duration();u<e&&(s=s.plus(n.silence(e-u))),s=s.plus(r);var a=this.duration();return a>o&&(s=s.plus(this.slice(o,a-o))),s},i.prototype.reverse=function(){var e=new i;for(var t=this.fragments.length;t--;){var n=this.fragments[t].clone();n.reverse=!n.isReversed(),e.add_fragment(n)}return e},i.prototype.pitch=function(e,t){var n=new i;t=t||!1;for(var r=0;r<this.fragments.length;r++){var s=this.fragments[r].clone();s.pitch*=e*.01,s.stretch=t,n.add_fragment(s)}return n},i.prototype.stretch=function(e){var t=1/(e*.01)*100;return this.pitch(t,!0)},i.prototype.pan=function(e){var t=new i;e>100?e=100:e<0&&(e=0);for(var n=0;n<this.fragments.length;n++){var r=this.fragments[n].clone();r.pan=e,t.add_fragment(r)}return t},i.prototype.silence=function(){return n.silence(this.duration())},i.prototype.join=function(e){var t=new i;for(var n=0;n<e.length;n++)e[n]instanceof i&&t.add_fragments(e[n].fragments);return t},i.prototype.getBuffer=function(){var e=44100;this.fragments.length>0&&(e=this.fragments[0].samplerate);var t=new o(this,e),n=this.duration()*e|0;return{samplerate:e,buffer:t.fetch(n)}},s.prototype.duration=function(){return this._duration*(100/this.pitch)},s.prototype.original_duration=function(){return this._duration},s.prototype.isReversed=function(){return this.reverse},s.prototype.isStretched=function(){return this.stretched},s.prototype.create=function(e,t){var n=this.duration();if(e>=n)return[null,e-n,t];var r=e+t>=n,i;r?(i=n-e,t-=i):(i=t,t=0);var s=this.clone();return s.start=this.start+e*this.pitch*.01,s._duration=i*this.pitch*.01,s.reverse=!1,[s,0,t]},s.prototype.clone=function(){var e=new s;return e.buffer=this.buffer,e.samplerate=this.samplerate,e.start=this.start,e._duration=this._duration,e.reverse=this.reverse,e.pitch=this.pitch,e.stretch=this.stretch,e.pan=this.pan,e},n.Fragment=s,n.TapeStream=o,o.prototype.reset=function(){return this.isEnded=!1,this.buffer=null,this.bufferIndex=0,this.bufferIndexIncr=0,this.bufferBeginIndex=0,this.bufferEndIndex=0,this.fragment=null,this.fragmentIndex=0,this.panL=.5,this.panR=.5,this.isLooped=!1,this},o.prototype.fetch=function(n){var r=new e.fn.SignalArray(n),i=new e.fn.SignalArray(n),s=this.fragments;if(s.length===0)return[r,i];var o=this.samplerate*100,u=this.buffer,a=this.bufferIndex,f=this.bufferIndexIncr,l=this.bufferBeginIndex,c=this.bufferEndIndex,h=this.fragment,p=this.fragmentIndex,d,v=this.panL,m=this.panR;for(var g=0;g<n;g++){while(!u||a<l||a>=c)if(!h||p<s.length)h=s[p++],u=h.buffer,f=h.samplerate/o*h.pitch,l=h.start*h.samplerate,c=l+h.original_duration()*h.samplerate,d=h.pan*.01,v=1-d,m=d,h.reverse?(f*=-1,a=c+f):a=l;else{if(!this.isLooped){this.isEnded=!0,u=t,f=0,a=0;break}u=null,a=0,f=0,l=0,c=0,h=null,p=0}r[g]=u[a|0]*v,i[g]=u[a|0]*m,a+=f}return this.buffer=u,this.bufferIndex=a,this.bufferIndexIncr=f,this.bufferBeginIndex=l,this.bufferEndIndex=c,this.fragment=h,this.fragmentIndex=p,this.panL=v,this.panR=m,[r,i]},e.modules.Scissor=n}(timbre),function(e){function t(t){this.samplerate=t;var n=Math.ceil(Math.log(t*1.5)*Math.LOG2E);this.buffersize=1<<n,this.buffermask=this.buffersize-1,this.writeBufferL=new e.fn.SignalArray(this.buffersize),this.writeBufferR=new e.fn.SignalArray(this.buffersize),this.readBufferL=this.writeBufferL,this.readBufferR=this.writeBufferR,this.delaytime=null,this.feedback=null,this.cross=null,this.mix=null,this.prevL=0,this.prevR=0,this.readIndex=0,this.writeIndex=0,this.setParams(125,.25,!1,.45)}var n=t.prototype;n.setParams=function(e,t,n,r){if(this.delaytime!==e){this.delaytime=e;var i=e*.001*this.samplerate|0;i>this.buffermask&&(i=this.buffermask),this.writeIndex=this.readIndex+i&this.buffermask}this.feedback!==t&&(this.feedback=t),this.cross!==n&&(this.cross=n,n?(this.readBufferL=this.writeBufferR,this.readBufferR=this.writeBufferL):(this.readBufferL=this.writeBufferL,this.readBufferR=this.writeBufferR)),this.mix!==r&&(this.mix=r)},n.process=function(e,t){var n=this.readBufferL,r=this.readBufferR,i=this.writeBufferL,s=this.writeBufferR,o=this.readIndex,u=this.writeIndex,a=this.buffermask,f=this.feedback,l=this.mix,c=1-l,h=this.prevL,p=this.prevR,d,v,m=e.length;for(v=0;v<m;++v)d=n[o],i[u]=e[v]-d*f,e[v]=h=(e[v]*c+d*l+h)*.5,d=r[o],s[u]=t[v]-d*f,t[v]=p=(t[v]*c+d*l+p)*.5,o+=1,u=u+1&a;this.readIndex=o&this.buffermask,this.writeIndex=u,this.prevL=h,this.prevR=p},e.modules.StereoDelay=t}(timbre),function(e){var t=e.fn,n=e.modules;t.register("audio",function(e){var n=t.getClass("buffer"),s=new n(e);return s.playbackState=t.FINISHED_STATE,s._.isLoaded=!1,Object.defineProperties(s,{isLoaded:{get:function(){return this._.isLoaded}}}),s.load=r,s.loadthis=i,s});var r=function(r){var i=this,s=this._,o=new n.Deferred(this),u=arguments,a=1;o.done(function(){i._.emit("done")}),typeof u[a]=="function"&&(o.done(u[a++]),typeof u[a]=="function"&&o.fail(u[a++])),s.loadedTime=0;var f=function(n,r){var s=i._;n?(i.playbackState=t.PLAYING_STATE,s.samplerate=n.samplerate,s.channels=n.channels,s.bufferMix=null,s.buffer=n.buffer,s.phase=0,s.phaseIncr=n.samplerate/e.samplerate,s.duration=n.duration*1e3,s.currentTime=0,s.isReversed&&(s.phaseIncr*=-1,s.phase=n.buffer[0].length+s.phaseIncr),i._.emit("loadedmetadata")):o.reject(r)},l=function(){i._.isLoaded=!0,i._.plotFlush=!0,i._.emit("loadeddata"),o.resolveWith(i)};return(new n.Decoder).decode(r,f,l),o.promise()},i=function(){return r.apply(this,arguments),this}}(timbre),function(e){function s(n){e.Object.call(this,2,n),t.fixAR(this);var i=this._;i.biquad=new r(i.samplerate),i.freq=e(340),i.band=e(1),i.gain=e(0),i.plotBefore=o,i.plotRange=[-18,18],i.plotFlush=!0}var t=e.fn,n=e.modules.FFT,r=e.modules.Biquad,i=20;t.extend(s);var o=function(e,t,n,r,s){e.lineWidth=1,e.strokeStyle="rgb(192, 192, 192)";var o=this._.samplerate*.5;for(var u=1;u<=10;++u)for(var a=1;a<=4;a++){var f=u*Math.pow(10,a);if(f<=i||o<=f)continue;e.beginPath();var l=Math.log(f/i)/Math.log(o/i);l=(l*r+t|0)+.5,e.moveTo(l,n),e.lineTo(l,n+s),e.stroke()}var c=s/6;for(u=1;u<6;u++){e.beginPath();var h=(n+u*c|0)+.5;e.moveTo(t,h),e.lineTo(t+r,h),e.stroke()}},u=s.prototype;Object.defineProperties(u,{type:{set:function(e){var t=this._;e!==t.biquad.type&&(t.biquad.setType(e),t.plotFlush=!0)},get:function(){return this._.biquad.type}},freq:{set:function(t){this._.freq=e(t)},get:function(){return this._.freq}},cutoff:{set:function(t){this._.freq=e(t)},get:function(){return this._.freq}},res:{set:function(t){this._.band=e(t)},get:function(){return this._.band}},Q:{set:function(t){this._.band=e(t)},get:function(){return this._.band}},band:{set:function(t){this._.band=e(t)},get:function(){return this._.band}},gain:{set:function(t){this._.gain=e(t)},get:function(){return this._.gain}}}),u.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e,t.inputSignalAR(this);var r=n.freq.process(e).cells[0][0],i=n.band.process(e).cells[0][0],s=n.gain.process(e).cells[0][0];if(n.prevFreq!==r||n.prevband!==i||n.prevGain!==s)n.prevFreq=r,n.prevband=i,n.prevGain=s,n.biquad.setParams(r,i,s),n.plotFlush=!0;n.bypassed||n.biquad.process(this.cells[1],this.cells[2]),t.outputSignalAR(this)}return this};var a=new n(2048),f=e.Object.prototype.plot;u.plot=function(e){if(this._.plotFlush){var t=new r(this._.samplerate);t.setType(this.type),t.setParams(this.freq.valueOf(),this.band.valueOf(),this.gain.valueOf());var n=new Float32Array(a.length);n[0]=1,t.process(n,n),a.forward(n);var s=512,o=new Float32Array(s),u=this._.samplerate*.5,l=new Float32Array(s),c,h,p,d,v,m,g,y;a.getFrequencyData(l);for(c=0;c<s;++c)p=Math.pow(u/i,c/s)*i,h=p/(u/l.length),d=h|0,v=h-d,d===0?g=m=y=l[d]:(m=l[d-1],g=l[d],y=(1-v)*m+v*g),o[c]=y;this._.plotData=o,this._.plotFlush=null}return f.call(this,e)},t.register("biquad",s),t.register("lowpass",function(e){return(new s(e)).set("type","lowpass")}),t.register("highpass",function(e){return(new s(e)).set("type","highpass")}),t.register("bandpass",function(e){return(new s(e)).set("type","bandpass")}),t.register("lowshelf",function(e){return(new s(e)).set("type","lowshelf")}),t.register("highshelf",function(e){return(new s(e)).set("type","highshelf")}),t.register("peaking",function(e){return(new s(e)).set("type","peaking")}),t.register("notch",function(e){return(new s(e)).set("type","notch")}),t.register("allpass",function(e){return(new s(e)).set("type","allpass")}),t.alias("lpf","lowpass"),t.alias("hpf","highpass"),t.alias("bpf","bandpass"),t.alias("bef","notch"),t.alias("brf","notch"),t.alias("apf","allpass")}(timbre),function(e){function i(n){e.Object.call(this,1,n),t.fixAR(this);var r=this._;r.pitch=e(1),r.samplerate=44100,r.channels=0,r.bufferMix=null,r.buffer=[],r.isLooped=!1,r.isReversed=!1,r.duration=0,r.currentTime=0,r.currentTimeObj=null,r.phase=0,r.phaseIncr=0,r.onended=t.make_onended(this,0),r.onlooped=s(this)}var t=e.fn,n=e.modules.Scissor.Tape,r=function(e){return t.isSignalArray(e)||e instanceof Float32Array};t.extend(i);var s=function(e){return function(){var t=e._;t.phase>=t.buffer[0].length?t.phase=0:t.phase<0&&(t.phase=t.buffer[0].length+t.phaseIncr),e._.emit("looped")}},o=i.prototype,u=function(t){var i=this._;if(typeof t=="object"){var s=[],o,u;r(t)?(s[0]=t,u=1):typeof t=="object"&&(t instanceof e.Object?t=t.buffer:t instanceof n&&(t=t.getBuffer()),Array.isArray(t.buffer)?r(t.buffer[0])&&(r(t.buffer[1])&&r(t.buffer[2])?(u=2,s=t.buffer):(u=1,s=[t.buffer[0]])):r(t.buffer)&&(u=1,s=[t.buffer]),typeof t.samplerate=="number"&&(o=t.samplerate)),s.length&&(o>0&&(i.samplerate=t.samplerate),i.bufferMix=null,i.buffer=s,i.phase=0,i.phaseIncr=i.samplerate/e.samplerate,i.duration=i.buffer[0].length*1e3/i.samplerate,i.currentTime=0,i.plotFlush=!0,this.reverse(i.isReversed))}};Object.defineProperties(o,{buffer:{set:u,get:function(){var e=this._;return{samplerate:e.samplerate,channels:e.channels,buffer:e.buffer}}},pitch:{set:function(t){this._.pitch=e(t)},get:function(){return this._.pitch}},isLooped:{get:function(){return this._.isLooped}},isReversed:{get:function(){return this._.isReversed}},samplerate:{get:function(){return this._.samplerate}},duration:{get:function(){return this._.duration}},currentTime:{set:function(t){if(typeof t=="number"){var n=this._;0<=t&&t<=n.duration&&(n.phase=t/1e3*n.samplerate,n.currentTime=t)}else t instanceof e.Object?this._.currentTimeObj=t:t===null&&(this._.currentTimeObj=null)},get:function(){return this._.currentTimeObj?this._.currentTimeObj:this._.currentTime}}}),o.clone=function(){var e=this._,n=t.clone(this);return e.buffer.length&&u.call(n,{buffer:e.buffer,samplerate:e.samplerate,channels:e.channels}),n.loop(e.isLooped),n.reverse(e.isReversed),n},o.slice=function(n,r){var i=this._,s=e(i.originkey),o=i.isReversed;if(i.buffer.length){typeof n=="number"?n=n*.001*i.samplerate|0:n=0,typeof r=="number"?r=r*.001*i.samplerate|0:r=i.buffer[0].length;if(n>r){var a=n;n=r,r=a,o=!o}i.channels===2?u.call(s,{buffer:[t.pointer(i.buffer[0],n,r-n),t.pointer(i.buffer[1],n,r-n),t.pointer(i.buffer[2],n,r-n)],samplerate:i.samplerate}):u.call(s,{buffer:t.pointer(i.buffer[0],n,r-n),samplerate:i.samplerate}),s.playbackState=t.PLAYING_STATE}return s.loop(i.isLooped),s.reverse(i.isReversed),s},o.reverse=function(e){var t=this._;return t.isReversed=!!e,t.isReversed?(t.phaseIncr>0&&(t.phaseIncr*=-1),t.phase===0&&t.buffer.length&&(t.phase=t.buffer[0].length+t.phaseIncr)):t.phaseIncr<0&&(t.phaseIncr*=-1),this},o.loop=function(e){return this._.isLooped=!!e,this},o.bang=function(e){return this.playbackState=e===!1?t.FINISHED_STATE:t.PLAYING_STATE,this._.phase=0,this._.emit("bang"),this},o.process=function(e){var n=this._;if(!n.buffer.length)return this;if(this.tickID!==e){this.tickID=e;var r=this.cells[1],i=this.cells[2],s=n.phase,o,u=n.cellsize,a,f;n.channels===2?(a=n.buffer[1],f=n.buffer[2]):a=f=n.buffer[0];if(n.currentTimeObj){var l=n.currentTimeObj.process(e).cells[0],c,h=n.samplerate*.001;for(o=0;o<u;++o)c=l[o],s=c*h,r[o]=a[s|0]||0,i[o]=f[s|0]||0;n.phase=s,n.currentTime=c}else{var p=n.pitch.process(e).cells[0][0],d=n.phaseIncr*p;for(o=0;o<u;++o)r[o]=a[s|0]||0,i[o]=f[s|0]||0,s+=d;s>=a.length?n.isLooped?t.nextTick(n.onlooped):t.nextTick(n.onended):s<0&&(n.isLooped?t.nextTick(n.onlooped):t.nextTick(n.onended)),n.phase=s,n.currentTime+=t.currentTimeIncr}t.outputSignalAR(this)}return this};var a=e.Object.prototype.plot;o.plot=function(e){var t=this._,n,r;if(t.plotFlush){t.channels===2?(n=t.buffer[1],r=t.buffer[2]):n=r=t.buffer[0];var i=new Float32Array(2048),s=0,o=n.length/2048;for(var u=0;u<2048;u++)i[u]=(n[s|0]+r[s|0])*.5,s+=o;t.plotData=i,t.plotFlush=null}return a.call(this,e)},t.register("buffer",i)}(timbre),function(e){function r(r){e.Object.call(this,2,r),t.fixAR(this);var i=new n(this._.samplerate);i.setDelayTime(20),i.setRate(4),i.depth=20,i.feedback=.2,i.mix=.33,this._.chorus=i}var t=e.fn,n=e.modules.Chorus;t.extend(r);var i=r.prototype;Object.defineProperties(i,{type:{set:function(e){this._.chorus.setDelayTime(e)},get:function(){return this._.chorus.wave}},delay:{set:function(e){.5<=e&&e<=80&&this._.chorus.setDelayTime(e)},get:function(){return this._.chorus.delayTime}},rate:{set:function(e){typeof e=="number"&&e>0&&this._.chorus.setRate(e)},get:function(){return this._.chorus.rate}},depth:{set:function(e){typeof e=="number"&&0<=e&&e<=100&&(e*=this._.samplerate/44100,this._.chorus.depth=e)},get:function(){return this._.chorus.depth}},fb:{set:function(e){typeof e=="number"&&-1<=e&&e<=1&&(this._.chorus.feedback=e*.99996)},get:function(){return this._.chorus.feedback}},mix:{set:function(t){this._.mix=e(t)},get:function(){return this._.mix}}}),i.process=function(e){var n=this._;return this.tickID!==e&&(this.tickID=e,t.inputSignalAR(this),n.bypassed||n.chorus.process(this.cells[1],this.cells[2]),t.outputSignalAR(this)),this},t.register("chorus",r)}(timbre),function(e){function n(t){e.Object.call(this,2,t);var n=this._;n.min=-0.8,n.max=.8}var t=e.fn;t.extend(n);var r=n.prototype;Object.defineProperties(r,{minmax:{set:function(e){var t=this._;typeof e=="number"&&(t.min=-Math.abs(e),t.max=-t.min)},get:function(){return this._.max}},min:{set:function(e){var t=this._;typeof e=="number"&&(t.max<e?t.max=e:t.min=e)},get:function(){return this._.min}},max:{set:function(e){var t=this._;typeof e=="number"&&(e<t.min?t.min=e:t.max=e)},get:function(){return this._.max}}}),r.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;var r=this.cells[1],i=this.cells[2],s,o=r.length,u=n.min,a=n.max,f;if(n.ar){t.inputSignalAR(this);for(s=0;s<o;++s)f=r[s],f<u?f=u:f>a&&(f=a),r[s]=f,f=i[s],f<u?f=u:f>a&&(f=a),i[s]=f;t.outputSignalAR(this)}else f=t.inputSignalKR(this),f<u?f=u:f>a&&(f=a),this.cells[0][0]=f,t.outputSignalKR(this)}return this},t.register("clip",n)}(timbre),function(e){function i(n){e.Object.call(this,2,n),t.fixAR(this);var i=this._;i.prevThresh=-24,i.prevKnee=30,i.prevRatio=12,i.thresh=e(i.prevThresh),i.knee=e(i.prevKnee),i.ratio=e(i.prevRatio),i.postGain=6,i.reduction=0,i.attack=3,i.release=25,i.comp=new r(i.samplerate),i.comp.dbPostGain=i.postGain,i.comp.setAttackTime(i.attack*.001),i.comp.setReleaseTime(i.release*.001),i.comp.setPreDelayTime(6),i.comp.setParams(i.prevThresh,i.prevKnee,i.prevRatio)}var t=e.fn,n=e.timevalue,r=e.modules.Compressor;t.extend(i);var s=i.prototype;Object.defineProperties(s,{thresh:{set:function(t){this._.thresh=e(t)},get:function(){return this._.thresh}},thre:{set:function(t){this._.thresh=e(t)},get:function(){return this._.thre}},knee:{set:function(t){this._.kne=e(t)},get:function(){return this._.knee}},ratio:{set:function(t){this._.ratio=e(t)},get:function(){return this._.ratio}},gain:{set:function(e){typeof e=="number"&&(this._.comp.dbPostGain=e)},get:function(){return this._.comp.dbPostGain}},attack:{set:function(e){typeof e=="string"&&(e=n(e)),typeof e=="number"&&(e=e<0?0:1e3<e?1e3:e,this._.attack=e,this._.comp.setAttackTime(e*.001))},get:function(){return this._.attack}},release:{set:function(e){typeof e=="string"&&(e=n(e)),typeof e=="number"&&(e=e<0?0:1e3<e?1e3:e,this._.release=e,this._.comp.setReleaseTime(e*.001))},get:function(){return this._.release}},reduction:{get:function(){return this._.reduction}}}),s.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e,t.inputSignalAR(this);var r=n.thresh.process(e).cells[0][0],i=n.knee.process(e).cells[0][0],s=n.ratio.process(e).cells[0][0];if(n.prevThresh!==r||n.prevKnee!==i||n.prevRatio!==s)n.prevThresh=r,n.prevKnee=i,n.prevRatio=s,n.comp.setParams(r,i,s);n.bypassed||(n.comp.process(this.cells[1],this.cells[2]),n.reduction=n.comp.meteringGain),t.outputSignalAR(this)}return this},t.register("comp",i)}(timbre),function(e){function i(n){e.Object.call(this,2,n),t.fixAR(this);var i=this._;i.time=e(100),i.fb=e(.2),i.cross=e(!1),i.mix=.33,i.delay=new r(i.samplerate)}var t=e.fn,n=e.timevalue,r=e.modules.StereoDelay;t.extend(i);var s=i.prototype;Object.defineProperties(s,{time:{set:function(t){typeof t=="string"&&(t=n(t)),this._.time=e(t)},get:function(){return this._.time}},fb:{set:function(t){this._.fb=e(t)},get:function(){return this._.fb}},cross:{set:function(t){this._.cross=e(t)},get:function(){return this._.cross}},mix:{set:function(e){typeof e=="number"&&(e=e>1?1:e<0?0:e,this._.mix=e)},get:function(){return this._.mix}}}),s.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;var r=n.time.process(e).cells[0][0],i=n.fb.process(e).cells[0][0],s=n.cross.process(e).cells[0][0]!==0,o=n.mix;if(n.prevTime!==r||n.prevFb!==i||n.prevCross!==s||n.prevMix!==o)n.prevTime=r,n.prevFb=i,n.prevCross=s,n.prevMix=o,n.delay.setParams(r,i,s,o);t.inputSignalAR(this),n.bypassed||n.delay.process(this.cells[1],this.cells[2]),t.outputSignalAR(this)}return this},t.register("delay",i)}(timbre),function(e){function n(n){e.Object.call(this,2,n),t.fixAR(this);var r=this._;r.pre=e(60),r.post=e(-18),r.x1L=r.x2L=r.y1L=r.y2L=0,r.x1R=r.x2R=r.y1R=r.y2R=0,r.b0=r.b1=r.b2=r.a1=r.a2=0,r.cutoff=0,r.Q=1,r.preScale=0,r.postScale=0}var t=e.fn;t.extend(n);var r=n.prototype;Object.defineProperties(r,{cutoff:{set:function(e){typeof e=="number"&&e>0&&(this._.cutoff=e)},get:function(){return this._.cutoff}},pre:{set:function(t){this._.pre=e(t)},get:function(){return this._.pre}},post:{set:function(t){this._.post=e(t)},get:function(){return this._.post}}}),r.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e,t.inputSignalAR(this);var r=-n.pre.process(e).cells[0][0],s=-n.post.process(e).cells[0][0];if(n.prevPreGain!==r||n.prevPostGain!==s)n.prevPreGain=r,n.prevPostGain=s,n.preScale=Math.pow(10,-r*.05),n.postScale=Math.pow(10,-s*.05);if(!n.bypassed){var o=this.cells[1],u=this.cells[2],a=n.preScale,f=n.postScale,l,c,h,p,d;if(n.cutoff){n.prevCutoff!==n.cutoff&&(n.prevCutoff=n.cutoff,i(n));var v=n.x1L,m=n.x2L,g=n.y1L,y=n.y2L,b=n.x1R,w=n.x2R,E=n.y1R,S=n.y2R,x=n.b0,T=n.b1,N=n.b2,C=n.a1,k=n.a2;for(l=0,c=o.length;l<c;++l)p=o[l]*a,d=x*p+T*v+N*m-C*g-k*y,h=d*f,h<-1?h=-1:h>1&&(h=1),o[l]=h,m=v,v=p,y=g,g=d,p=u[l]*a,d=x*p+T*b+N*w-C*E-k*S,h=d*f,h<-1?h=-1:h>1&&(h=1),u[l]=h,w=b,b=p,S=E,E=d;n.x1L=v,n.x2L=m,n.y1L=g,n.y2L=y,n.x1R=b,n.x2R=w,n.y1R=E,n.y2R=S}else for(l=0,c=o.length;l<c;++l)h=o[l]*a*f,h<-1?h=-1:h>1&&(h=1),o[l]=h,h=u[l]*a*f,h<-1?h=-1:h>1&&(h=1),u[l]=h}t.outputSignalAR(this)}return this};var i=function(e){var t=2*Math.PI*e.cutoff/e.samplerate,n=Math.cos(t),r=Math.sin(t),i=r/(2*e.Q),s=1/(1+i);e.b0=(1-n)*.5*s,e.b1=1-n*s,e.b2=(1-n)*.5*s,e.a1=-2*n*s,e.a2=1-i*s};t.register("dist",n)}(timbre),function(e){function n(t){e.Object.call(this,2,t),this._.ar=!1}var t=e.fn;t.extend(n);var r=n.prototype;r.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;var r=this.nodes,i=this.cells[0],s=this.cells[1],o=this.cells[2],u,a=r.length,f,l=i.length,c,h,p,d;if(n.ar){if(r.length>0){r[0].process(e),h=r[0].cells[1],p=r[0].cells[2],s.set(h),o.set(p);for(u=1;u<a;++u){r[u].process(e),h=r[u].cells[1],p=r[u].cells[2];for(f=0;f<l;++f)d=h[f],s[f]=d===0?0:s[f]/d,d=p[f],o[f]=d===0?0:o[f]/d}}else for(f=0;f<l;++f)s[f]=o[u]=0;t.outputSignalAR(this)}else{if(r.length>0){c=r[0].process(e).cells[0][0];for(u=1;u<a;++u)d=r[u].process(e).cells[0][0],c=d===0?0:c/d}else c=0;i[0]=c,t.outputSignalKR(this)}}return this},t.register("/",n)}(timbre),function(e){function s(n){e.Object.call(this,2,n);var i=this._;i.env=new r(i.samplerate),i.env.setStep(i.cellsize),i.tmp=new t.SignalArray(i.cellsize),i.ar=!1,i.plotFlush=!0,i.onended=u(this),this.on("ar",o)}function c(e,t,n,r,i,s){var o=n;return typeof e[r]=="number"?o=e[r]:typeof e[i]=="number"?o=e[i]:s&&(typeof e[r]=="string"?o=s(e[r]):typeof e[i]=="string"&&(o=s(e[i]))),o<t&&(o=t),o}var t=e.fn,n=e.timevalue,r=e.modules.Envelope,i=t.isDictionary;t.extend(s);var o=function(e){this._.env.setStep(e?1:this._.cellsize)},u=function(e){return function(){e._.emit("ended")}},a=s.prototype;Object.defineProperties(a,{table:{set:function(e){Array.isArray(e)&&(f.call(this,e),this._.plotFlush=!0)},get:function(){return this._.env.table}},curve:{set:function(e){this._.env.setCurve(e)},get:function(){return this._.env.curve}},releaseNode:{set:function(e){this._.env.setReleaseNode(e),this._.plotFlush=!0},get:function(){return this._.env.releaseNode+1}},loopNode:{set:function(e){this._.env.setLoopNode(e),this._.plotFlush=!0},get:function(){return this._.env.loopNode+1}}}),a.clone=function(){var e=t.clone(this);return e._.env=this._.env.clone(),e},a.reset=function(){return this._.env.reset(),this},a.release=function(){var e=this._;return e.env.release(),e.emit("released"),this},a.bang=function(){var e=this._;return e.env.reset(),e.env.status=r.StatusGate,e.emit("bang"),this},a.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;var r=this.cells[1],i=this.cells[2],s,o=n.cellsize;if(this.nodes.length)t.inputSignalAR(this);else for(s=0;s<o;++s)r[s]=i[s]=1;var u,a=null;if(n.ar){var f=n.tmp;n.env.process(f);for(s=0;s<o;++s)r[s]*=f[s],i[s]*=f[s];a=n.env.emit}else{u=n.env.next();for(s=0;s<o;++s)r[s]*=u,i[s]*=u;a=n.env.emit}t.outputSignalAR(this),a&&(a==="ended"?t.nextTick(n.onended):this._.emit(a,n.value))}return this};var f=function(e){var t=this._.env,i=[e[0]||h],s,o,u,a;for(var f=1,l=e.length;f<l;++f)s=e[f][0]||h,o=e[f][1],u=e[f][2],typeof o!="number"&&(typeof o=="string"?o=n(o):o=10),o<10&&(o=10),typeof u=="number"?(a=u,u=r.CurveTypeCurve):(u=r.CurveTypeDict[u]||null,a=0),i.push([s,o,u,a]);t.setTable(i)},l=e.Object.prototype.plot;a.plot=function(e){if(this._.plotFlush){var t=this._.env.clone(),n=t.getInfo(1e3),i=n.totalDuration,s=n.loopBeginTime,o=n.releaseBeginTime,u=new Float32Array(256),a=0,f=i/u.length,c=!1,h=i*.001*this._.samplerate|0,p,d;h/=u.length,t.setStep(h),t.status=r.StatusGate;for(p=0,d=u.length;p<d;++p)u[p]=t.next(),a+=f,!c&&a>=o&&(t.release(),c=!0);this._.plotData=u,this._.plotBefore=function(e,t,n,r,u){var a,f;s!==Infinity&&o!==Infinity&&(a=t+r*(s/i),f=t+r*(o/i),f-=a,e.fillStyle="rgba(224, 224, 224, 0.8)",e.fillRect(a,0,f,u)),o!==Infinity&&(a=t+r*(o/i),f=r-a,e.fillStyle="rgba(212, 212, 212, 0.8)",e.fillRect(a,0,f,u))};var v=Infinity,m=-Infinity;for(p=0;p<d;++p)u[p]<v?v=u[p]:u[p]>m&&(m=u[p]);m<1&&(m=1),this._.plotRange=[v,m],this._.plotData=u,this._.plotFlush=null}return l.call(this,e)},t.register("env",s);var h=r.ZERO;t.register("perc",function(e){i(e[0])||e.unshift({});var t=e[0],r=c(t,10,10,"a","attackTime",n),o=c(t,10,1e3,"r","releaseTime",n),u=c(t,h,1,"lv","level");return t.table=[h,[u,r],[h,o]],new s(e)}),t.register("adsr",function(e){i(e[0])||e.unshift({});var t=e[0],r=c(t,10,10,"a","attackTime",n),o=c(t,10,300,"d","decayTime",n),u=c(t,h,.5,"s","sustainLevel"),a=c(t,10,1e3,"r","decayTime",n),f=c(t,h,1,"lv","level");return t.table=[h,[f,r],[u,o],[h,a]],t.releaseNode=3,new s(e)}),t.register("adshr",function(e){i(e[0])||e.unshift({});var t=e[0],r=c(t,10,10,"a","attackTime",n),o=c(t,10,300,"d","decayTime",n),u=c(t,h,.5,"s","sustainLevel"),a=c(t,10,500,"h","holdTime",n),f=c(t,10,1e3,"r","decayTime",n),l=c(t,h,1,"lv","level");return t.table=[h,[l,r],[u,o],[u,a],[h,f]],new s(e)}),t.register("asr",function(e){i(e[0])||e.unshift({});var t=e[0],r=c(t,10,10,"a","attackTime",n),o=c(t,h,.5,"s","sustainLevel"),u=c(t,10,1e3,"r","releaseTime",n);return t.table=[h,[o,r],[h,u]],t.releaseNode=2,new s(e)}),t.register("dadsr",function(e){i(e[0])||e.unshift({});var t=e[0],r=c(t,10,100,"dl","delayTime",n),o=c(t,10,10,"a","attackTime",n),u=c(t,10,300,"d","decayTime",n),a=c(t,h,.5,"s","sustainLevel"),f=c(t,10,1e3,"r","relaseTime",n),l=c(t,h,1,"lv","level");return t.table=[h,[h,r],[l,o],[a,u],[h,f]],t.releaseNode=4,new s(e)}),t.register("ahdsfr",function(e){i(e[0])||e.unshift({});var t=e[0],r=c(t,10,10,"a","attackTime",n),o=c(t,10,10,"h","holdTime",n),u=c(t,10,300,"d","decayTime",n),a=c(t,h,.5,"s","sustainLevel"),f=c(t,10,5e3,"f","fadeTime",n),l=c(t,10,1e3,"r","relaseTime",n),p=c(t,h,1,"lv","level");return t.table=[h,[p,r],[p,o],[a,u],[h,f],[h,l]],t.releaseNode=5,new s(e)}),t.register("linen",function(e){i(e[0])||e.unshift({});var t=e[0],r=c(t,10,10,"a","attackTime",n),o=c(t,10,1e3,"s","sustainTime",n),u=c(t,10,1e3,"r","releaseTime",n),a=c(t,h,1,"lv","level");return t.table=[h,[a,r],[a,o],[h,u]],new s(e)}),t.register("env.tri",function(e){i(e[0])||e.unshift({});var t=e[0],r=c(t,20,1e3,"dur","duration",n),o=c(t,h,1,"lv","level");return r*=.5,t.table=[h,[o,r],[h,r]],new s(e)}),t.register("env.cutoff",function(e){i(e[0])||e.unshift({});var t=e[0],r=c(t,10,100,"r","relaseTime",n),o=c(t,h,1,"lv","level");return t.table=[o,[h,r]],new s(e)})}(timbre),function(e){function o(n){e.Object.call(this,2,n),t.fixAR(this);var r=this._;r.biquads=new Array(7),r.plotBefore=u,r.plotRange=[-18,18],r.plotFlush=!0}var t=e.fn,n=e.modules.FFT,r=e.modules.Biquad,i=20,s={hpf:0,lf:1,lmf:2,mf:3,hmf:4,hf:5,lpf:6};t.extend(o);var u=function(e,t,n,r,s){e.lineWidth=1,e.strokeStyle="rgb(192, 192, 192)";var o=this._.samplerate*.5;for(var u=1;u<=10;++u)for(var a=1;a<=4;a++){var f=u*Math.pow(10,a);if(f<=i||o<=f)continue;e.beginPath();var l=Math.log(f/i)/Math.log(o/i);l=(l*r+t|0)+.5,e.moveTo(l,n),e.lineTo(l,n+s),e.stroke()}var c=s/6;for(u=1;u<6;u++){e.beginPath();var h=(n+u*c|0)+.5;e.moveTo(t,h),e.lineTo(t+r,h),e.stroke()}},a=o.prototype;Object.defineProperties(a,{params:{set:function(e){if(typeof e=="object"){var t=Object.keys(e);for(var n=0,r=t.length;n<r;++n){var i=e[t[n]];Array.isArray(i)?this.setParams(t[n],i[0],i[1],i[2]):this.setParams(t[n])}}}}}),a.setParams=function(e,t,n,i){var o=this._;typeof e=="string"&&(e=s[e]);if(0<=e&&e<o.biquads.length){e|=0;if(typeof t=="number"&&typeof n=="number"){typeof i!="number"&&(i=0);var u=o.biquads[e];if(!u){u=o.biquads[e]=new r(o.samplerate);switch(e){case 0:u.setType("highpass");break;case o.biquads.length-1:u.setType("lowpass");break;default:u.setType("peaking")}}u.setParams(t,n,i)}else o.biquads[e]=undefined;o.plotFlush=!0}return this},a.getParams=function(e){var t=this._,n=t.biquads[e|0];if(n)return{freq:n.frequency,Q:n.Q,gain:n.gain}},a.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e,t.inputSignalAR(this);if(!n.bypassed){var r=this.cells[1],i=this.cells[2],s=n.biquads;for(var o=0,u=s.length;o<u;++o)s[o]&&s[o].process(r,i)}t.outputSignalAR(this)}return this};var f=new n(2048),l=e.Object.prototype.plot;a.plot=function(e){if(this._.plotFlush){var t=this._,n=new Float32Array(f.length);n[0]=1;for(var s=0,o=t.biquads.length;s<o;++s){var u=this.getParams(s);if(u){var a=new r(t.samplerate);s===0?a.setType("highpass"):s===o-1?a.setType("lowpass"):a.setType("peaking"),a.setParams(u.freq,u.Q,u.gain),a.process(n,n)}}f.forward(n);var c=512,h=new Float32Array(c),p=t.samplerate*.5,d=new Float32Array(c),v,m,g,y,b,w,E;f.getFrequencyData(d);for(s=0;s<c;++s)m=Math.pow(p/i,s/c)*i,v=m/(p/d.length),g=v|0,y=v-g,g===0?w=b=E=d[g]:(b=d[g-1],w=d[g],E=(1-y)*b+y*w),h[s]=E;this._.plotData=h,this._.plotFlush=null}return l.call(this,e)},t.register("eq",o)}(timbre),function(e){function r(r){e.Object.call(this,2,r),t.listener(this),t.fixAR(this),this.real=new e.ChannelObject(this),this.imag=new e.ChannelObject(this),this.cells[3]=this.real.cell,this.cells[4]=this.imag.cell;var i=this._;i.fft=new n(i.cellsize*2),i.fftCell=new t.SignalArray(i.fft.length),i.prevCell=new t.SignalArray(i.cellsize),i.freqs=new t.SignalArray(i.fft.length>>1),i.plotFlush=!0,i.plotRange=[0,32],i.plotBarStyle=!0}var t=e.fn,n=e.modules.FFT;t.extend(r);var i=r.prototype;Object.defineProperties(i,{window:{set:function(e){this._.fft.setWindow(e)},get:function(){return this._.fft.windowName}},spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}}}),i.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e,t.inputSignalAR(this),t.outputSignalAR(this);var r=this.cells[0],i=n.cellsize;n.fftCell.set(n.prevCell),n.fftCell.set(r,i),n.fft.forward(n.fftCell),n.prevCell.set(r),n.plotFlush=!0,this.cells[3].set(n.fft.real.subarray(0,i)),this.cells[4].set(n.fft.imag.subarray(0,i))}return this};var s=e.Object.prototype.plot;i.plot=function(e){return this._.plotFlush&&(this._.plotData=this.spectrum,this._.plotFlush=null),s.call(this,e)},t.register("fft",r)}(timbre),function(e){function n(n){e.Object.call(this,1,n),t.fixAR(this);var r=this._;r.freq=e(440),r.reg=32768,r.shortFlag=!1,r.phase=0,r.lastValue=0}var t=e.fn;t.extend(n);var r=n.prototype;Object.defineProperties(r,{shortFlag:{set:function(e){this._.shortFlag=!!e},get:function(){return this._.shortFlag}},freq:{set:function(t){this._.freq=e(t)},get:function(){return this._.freq}}}),r.process=function(e){var t=this._,n=this.cells[0];if(this.tickID!==e){this.tickID=e;var r=t.lastValue,i=t.phase,s=t.freq.process(e).cells[0][0]/t.samplerate,o=t.reg,u=t.mul,a=t.add,f,l;if(t.shortFlag)for(f=0,l=n.length;f<l;++f)i>=1&&(o>>=1,o|=((o^o>>6)&1)<<15,r=(o&1)-.5,i-=1),n[f]=r*u+a,i+=s;else for(f=0,l=n.length;f<l;++f)i>=1&&(o>>=1,o|=((o^o>>1)&1)<<15,r=(o&1)-.5,i-=1),n[f]=r*u+a,i+=s;t.reg=o,t.phase=i,t.lastValue=r}return this},t.register("fnoise",n)}(timbre),function(e){function r(n){e.Object.call(this,2,n),t.fixAR(this),this._.selected=0,this._.outputs=[]}var t=e.fn,n=function(){function n(n){e.Object.call(this,2,[]),t.fixAR(this),this._.parent=n}return t.extend(n),n.prototype.process=function(e){return this.tickID!==e&&(this.tickID=e,this._.parent.process(e)),this},n}();t.extend(r);var i=r.prototype;Object.defineProperties(i,{selected:{set:function(e){var n=this._;if(typeof e=="number"){n.selected=e;var r=n.outputs;for(var i=0,s=r.length;i<s;++i)r[i]&&(r[i].cells[0].set(t.emptycell),r[i].cells[1].set(t.emptycell),r[i].cells[2].set(t.emptycell))}},get:function(){return this._.selected}}}),i.at=function(e){var t=this._,r=t.outputs[e];return r||(t.outputs[e]=r=new n(this)),r},i.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e,t.inputSignalAR(this),t.outputSignalAR(this);var r=n.outputs[n.selected];r&&(r.cells[0].set(this.cells[0]),r.cells[1].set(this.cells[1]),r.cells[2].set(this.cells[2]))}return this},t.register("gate",r)}(timbre),function(e){function r(r){e.Object.call(this,1,r),t.fixAR(this);var i=this._;i.fft=new n(i.cellsize*2),i.fftCell=new t.SignalArray(this._.fft.length),i.realBuffer=new t.SignalArray(this._.fft.length),i.imagBuffer=new t.SignalArray(this._.fft.length)}var t=e.fn,n=e.modules.FFT;t.extend(r);var i=r.prototype;Object.defineProperties(i,{real:{set:function(t){this._.real=e(t)},get:function(){return this._.real}},imag:{set:function(t){this._.imag=e(t)},get:function(){return this._.imag}}}),i.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;if(n.real&&n.imag){var r=this.cells[0],i=n.realBuffer,s=n.imagBuffer,o=n.real.process(e).cells[0],u=n.imag.process(e).cells[0];i.set(o),s.set(u),r.set(n.fft.inverse(i,s).subarray(0,n.cellsize)),t.outputSignalAR(this)}}return this},t.register("ifft",r)}(timbre),function(e){function r(n){e.Object.call(this,1,n),t.timer(this),t.fixKR(this);var r=this._;r.interval=e(1e3),r.count=0,r.delay=0,r.timeout=Infinity,r.currentTime=0,r.delaySamples=0,r.countSamples=0,r.onended=t.make_onended(this),this.on("start",i)}var t=e.fn,n=e.timevalue;t.extend(r);var i=function(){var e=this._;this.playbackState=t.PLAYING_STATE,e.delaySamples=e.samplerate*e.delay*.001|0,e.countSamples=e.count=e.currentTime=0};Object.defineProperty(i,"unremovable",{value:!0,writable:!1});var s=r.prototype;Object.defineProperties(s,{interval:{set:function(t){typeof t=="string"&&(t=n(t),t<=0&&(t=0)),this._.interval=e(t)},get:function(){return this._.interval}},delay:{set:function(e){typeof e=="string"&&(e=n(e)),typeof e=="number"&&e>=0&&(this._.delay=e,this._.delaySamples=this._.samplerate*e*.001|0)},get:function(){return this._.delay}},count:{set:function(e){typeof e=="number"&&(this._.count=e)},get:function(){return this._.count}},timeout:{set:function(e){typeof e=="string"&&(e=n(e)),typeof e=="number"&&e>=0&&(this._.timeout=e)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}}),s.bang=function(){var e=this._;return this.playbackState=t.PLAYING_STATE,e.delaySamples=e.samplerate*e.delay*.001|0,e.countSamples=e.count=e.currentTime=0,e.emit("bang"),this},s.process=function(e){var n=this.cells[0],r=this._;if(this.tickID!==e){this.tickID=e,r.delaySamples>0&&(r.delaySamples-=n.length);var i=r.interval.process(e).cells[0][0];if(r.delaySamples<=0){r.countSamples-=n.length;if(r.countSamples<=0){r.countSamples+=r.samplerate*i*.001|0;var s=this.nodes,o=r.count,u=o*r.mul+r.add;for(var a=0,f=n.length;a<f;++a)n[a]=u;for(var l=0,c=s.length;l<c;++l)s[l].bang(o);r.count+=1}}r.currentTime+=t.currentTimeIncr,r.currentTime>=r.timeout&&t.nextTick(r.onended)}return this},t.register("interval",r)}(timbre),function(e){function r(n){e.Object.call(this,1,n),t.fixAR(this);var r=this._,i=Math.ceil(Math.log(r.samplerate)*Math.LOG2E);r.buffersize=1<<i,r.buffermask=r.buffersize-1,r.buffer=new t.SignalArray(r.buffersize),r.time=0,r.readIndex=0,r.writeIndex=0}var t=e.fn,n=e.timevalue;t.extend(r);var i=r.prototype;Object.defineProperties(i,{time:{set:function(e){typeof e=="string"&&(e=n(e));if(typeof e=="number"&&e>0){var t=this._;t.time=e;var r=e*.001*t.samplerate|0;r>t.buffermask&&(r=t.buffermask),t.writeIndex=t.readIndex+r&t.buffermask}},get:function(){return this._.time}}}),i.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e,t.inputSignalAR(this);var r=this.cells[0],i=n.buffer,s=n.buffermask,o=n.readIndex,u=n.writeIndex,a,f=r.length;for(a=0;a<f;++a)i[u]=r[a],r[a]=i[o],o+=1,u=u+1&s;n.readIndex=o&s,n.writeIndex=u,t.outputSignalAR(this)}return this},t.register("lag",r)}(timbre),function(e){function n(t){e.Object.call(this,1,t);var n=this._;n.input=0,n.value=0,n.prev=null,n.ar=!1,n.map=r}var t=e.fn;t.extend(n);var r=function(e){return e},i=n.prototype;Object.defineProperties(i,{input:{set:function(e){typeof e=="number"&&(this._.input=e)},get:function(){return this._.input}},map:{set:function(e){typeof e=="function"&&(this._.map=e)},get:function(){return this._.map}}}),i.bang=function(){return this._.prev=null,this._.emit("bang"),this},i.at=function(e){return this._.map?this._.map(e):0},i.process=function(e){var n=this.cells[0],r=this._;if(this.tickID!==e){this.tickID=e;var i=this.nodes.length,s,o=n.length;if(r.ar&&i){t.inputSignalAR(this);var u=r.map;if(u)for(s=0;s<o;++s)n[s]=u(n[s]);r.value=n[o-1],t.outputSignalAR(this)}else{var a=i?t.inputSignalKR(this):r.input;r.map&&r.prev!==a&&(r.prev=a,r.value=r.map(a));var f=r.value*r.mul+r.add;for(s=0;s<o;++s)n[s]=f}}return this},t.register("map",n)}(timbre),function(e){function n(t){e.Object.call(this,1,t)}var t=e.fn;t.extend(n);var r=n.prototype;r.process=function(e){var n=this.cells[0],r=this._;if(this.tickID!==e){this.tickID=e;var i=this.nodes,s,o=i.length,u,a=n.length,f,l;if(r.ar){if(i.length>0){f=i[0].process(e).cells[0],n.set(f);for(s=1;s<o;++s){f=i[s].process(e).cells[0];for(u=0;u<a;++u)l=f[u],n[u]<l&&(n[u]=l)}}else for(u=0;u<a;++u)n[u]=0;t.outputSignalAR(this)}else{if(i.length>0){f=i[0].process(e).cells[0][0];for(s=1;s<o;++s)l=i[s].process(e).cells[0][0],f<l&&(f=l)}else f=0;n[0]=f,t.outputSignalKR(this)}}return this},t.register("max",n)}(timbre),function(e){function i(r){e.Object.call(this,2,r),t.fixAR(this);var i=this._;i.src=i.func=null,i.bufferL=new t.SignalArray(n),i.bufferR=new t.SignalArray(n),i.readIndex=0,i.writeIndex=0,i.totalRead=0,i.totalWrite=0}if(e.envtype!=="browser")return;var t=e.fn,n=4096,r=n-1;t.extend(i);var s=i.prototype;s.listen=function(t){var n=o[e.env];n&&(n.set.call(this,t),n.listen.call(this))},s.unlisten=function(){var n=o[e.env];n&&n.unlisten.call(this),this.cells[0].set(t.emptycell),this.cells[1].set(t.emptycell),this.cells[2].set(t.emptycell);var r=this._,i=r.bufferL,s=r.bufferR;for(var u=0,a=i.length;u<a;++u)i[u]=s[u]=0},s.process=function(e){var n=this._;if(n.src===null)return this;if(this.tickID!==e){this.tickID=e;var i=n.cellsize;if(n.totalWrite>n.totalRead+i){var s=n.readIndex,o=s+i;this.cells[1].set(n.bufferL.subarray(s,o)),this.cells[2].set(n.bufferR.subarray(s,o)),n.readIndex=o&r,n.totalRead+=i}t.outputSignalAR(this)}return this};var o={};o.webkit={set:function(e){var n=this._;if(e instanceof HTMLMediaElement){var r=t._audioContext;n.src=r.createMediaElementSource(e)}},listen:function(){var e=this._,n=t._audioContext;e.gain=n.createGainNode(),e.gain.gain.value=0,e.node=n.createJavaScriptNode(1024,2,2),e.node.onaudioprocess=u(this),e.src.connect(e.node),e.node.connect(e.gain),e.gain.connect(n.destination)},unlisten:function(){var e=this._;e.src&&e.src.disconnect(),e.gain&&e.gain.disconnect(),e.node&&e.node.disconnect()}};var u=function(e){return function(t){var n=e._,i=t.inputBuffer,s=i.length,o=n.writeIndex;n.bufferL.set(i.getChannelData(0),o),n.bufferR.set(i.getChannelData(1),o),n.writeIndex=o+s&r,n.totalWrite+=s}};o.moz={set:function(e){var t=this._;e instanceof HTMLAudioElement&&(t.src=e,t.istep=t.samplerate/e.mozSampleRate)},listen:function(){var e=this._,t=e.bufferL,n=e.bufferR,i=0,s=0;e.src.mozChannels===2?(e.x=0,e.func=function(o){var u=e.writeIndex,a=e.totalWrite,f=o.frameBuffer,l,c=e.istep,h,p=f.length;l=e.x;for(h=0;h<p;h+=2){l+=c;while(l>0)t[u]=(f[h]+i)*.5,n[u]=(f[h+1]+s)*.5,u=u+1&r,++a,l-=1;i=f[h],s=f[h+1]}e.x=l,e.writeIndex=u,e.totalWrite=a}):(e.x=0,e.func=function(s){var o=e.writeIndex,u=e.totalWrite,a=s.frameBuffer,f,l=e.istep,c,h=a.length;f=e.x;for(c=0;c<h;++c){f+=l;while(f>=0)t[o]=n[o]=(a[c]+i)*.5,o=o+1&r,++u,f-=1;i=a[c]}e.x=f,e.writeIndex=o,e.totalWrite=u}),e.src.addEventListener("MozAudioAvailable",e.func)},unlisten:function(){var e=this._;e.func&&(e.src.removeEventListener("MozAudioAvailable",e.func),e.func=null)}},t.register("mediastream",i)}(timbre),function(e){function n(t){e.Object.call(this,1,t);var n=this._;n.midi=0,n.value=0,n.prev=null,n.a4=440,n.ar=!1}var t=e.fn;t.extend(n);var r=n.prototype;Object.defineProperties(r,{midi:{set:function(e){typeof e=="number"&&(this._.midi=e)},get:function(){return this._.midi}},a4:{set:function(e){typeof e=="number"&&(this._.a4=e,this._.prev=null)},get:function(){return this._.a4}}}),r.bang=function(){return this._.prev=null,this._.emit("bang"),this},r.at=function(e){var t=this._;return t.a4*Math.pow(2,(e-69)/12)},r.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;var r=this.cells[0],i=this.nodes.length,s,o=r.length;if(n.ar&&i){t.inputSignalAR(this);var u=n.a4;for(s=0;s<o;++s)r[s]=u*Math.pow(2,(r[s]-69)/12);n.value=r[o-1],t.outputSignalAR(this)}else{var a=i?t.inputSignalKR(this):n.midi;n.prev!==a&&(n.prev=a,n.value=n.a4*Math.pow(2,(a-69)/12)),r[0]=n.value,t.outputSignalKR(this)}}return this},t.register("midicps",n)}(timbre),function(e){function n(t){e.Object.call(this,1,t);var n=this._;n.midi=0,n.value=0,n.prev=null,n.range=12,n.ar=!1}var t=e.fn;t.extend(n);var r=n.prototype;Object.defineProperties(r,{midi:{set:function(e){typeof e=="number"&&(this._.midi=e)},get:function(){return this._.midi}},range:{set:function(e){typeof e=="number"&&e>0&&(this._.range=e)},get:function(){return this._.range}}}),r.bang=function(){return this._.prev=null,this._.emit("bang"),this},r.at=function(e){var t=this._;return Math.pow(2,e/t.range)},r.process=function(e){var n=this.cells[0],r=this._;if(this.tickID!==e){this.tickID=e;var i=this.nodes.length,s,o=n.length;if(r.ar&&i){t.inputSignalAR(this);var u=r.range;for(s=0;s<o;++s)n[s]=Math.pow(2,n[s]/u);r.value=n[o-1],t.outputSignalAR(this)}else{var a=this.nodes.length?t.inputSignalKR(this):r.midi;r.prev!==a&&(r.prev=a,r.value=Math.pow(2,a/r.range));var f=r.value*r.mul+r.add;for(s=0;s<o;++s)n[s]=f}}return this},t.register("midiratio",n)}(timbre),function(e){function n(t){e.Object.call(this,1,t)}var t=e.fn;t.extend(n);var r=n.prototype;r.process=function(e){var n=this.cells[0],r=this._;if(this.tickID!==e){this.tickID=e;var i=this.nodes,s,o=i.length,u,a=n.length,f,l;if(r.ar){if(i.length>0){f=i[0].process(e).cells[0],n.set(f);for(s=1;s<o;++s){f=i[s].process(e).cells[0];for(u=0;u<a;++u)l=f[u],n[u]>l&&(n[u]=l)}}else for(u=0;u<a;++u)n[u]=0;t.outputSignalAR(this)}else{if(i.length>0){f=i[0].process(e).cells[0][0];for(s=1;s<o;++s)l=i[s].process(e).cells[0][0],f>l&&(f=l)}else f=0;n[0]=f,t.outputSignalKR(this)}}return this},t.register("min",n)}(timbre),function(e){function n(n){e.Object.call(this,0,n),t.timer(this),t.fixKR(this);var i=this._;i.tracks=[],i.onended=t.make_onended(this),i.currentTime=0,this.on("start",r)}var t=e.fn;t.extend(n);var r=function(){var e=this,n=this._,r=n.mml;typeof r=="string"&&(r=[r]),n.tracks=r.map(function(t,n){return new s(e,n,t)}),n.currentTime=0,this.playbackState=t.PLAYING_STATE};Object.defineProperty(r,"unremoved",{value:!0,writable:!1});var i=n.prototype;Object.defineProperties(i,{mml:{set:function(e){var t=this._;if(typeof e=="string"||Array.isArray(e))t.mml=e},get:function(){return this._.mml}},currentTime:{get:function(){return this._.currentTime}}}),i.on=i.addListener=function(e,t){return e==="mml"&&(e="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.on(e,t),this},i.once=function(e,t){return e==="mml"&&(e="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.once(e,t),this},i.off=i.removeListener=function(e,t){return e==="mml"&&(e="data",console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener.")),this._.events.off(e,t),this},i.removeAllListeners=function(e){return e==="mml"&&(console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener."),e="data"),this._.events.removeAllListeners(e),this},i.listeners=function(e){return e==="mml"&&(console.warn("A 'mml' event listener was deprecated in ~v13.03.01. use 'data' event listener."),e="data"),this._.events.listeners(e)},i.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;var r,i,s=n.tracks;for(r=0,i=s.length;r<i;++r)s[r].process();while(r--)s[r].ended&&s.splice(r,1);s.length===0&&t.nextTick(n.onended),n.currentTime+=t.currentTimeIncr}return this},t.register("mml",n);var s=function(){function e(e,t,n){var r=this._={};r.sequencer=e,r.trackNum=t,r.commands=l(n),r.status={t:120,l:4,o:4,v:12,q:6,dot:0,tie:!1},r.index=0,r.queue=[],r.currentTime=0,r.queueTime=0,r.segnoIndex=-1,r.loopStack=[],r.prevNote=0,r.remain=Infinity,this.ended=!1,f(this)}var n=0,r=1,i=2,s=3;e.prototype.process=function(){var e=this._,l=e.sequencer,c=e.trackNum,h=e.queue,p=!1;if(h.length)while(h[0][0]<=e.currentTime){var d=e.queue.shift();switch(d[1]){case r:o(l,c,d[2],d[3]),e.remain=d[4],f(this);break;case i:u(l,c,d[2],d[3]);break;case s:a(l,d[2]);break;case n:p=!0}if(h.length===0)break}e.remain-=t.currentTimeIncr,p&&(this.ended=!0),e.currentTime+=t.currentTimeIncr};var o=function(e,t,n,r){var i,s,o,u=e.nodes;for(s=0,o=u.length;s<o;++s)i=u[s],i.noteOn?i.noteOn(n,r):i.bang();e._.emit("data","noteOn",{trackNum:t,noteNum:n,velocity:r})},u=function(e,t,n,r){var i,s,o,u=e.nodes;for(s=0,o=u.length;s<o;++s)i=u[s],i.noteOff?i.noteOff(n,r):i.release&&i.release();e._.emit("data","noteOff",{trackNum:t,noteNum:n,velocity:r})},a=function(e,t){e._.emit("data","command",{command:t})},f=function(e){var t=e._,o=t.sequencer,u,a=t.commands,f=t.queue,l=t.index,c=t.status,h=t.queueTime,p=t.loopStack,d,v,m,g,y,b,w,E,S,x,T,N;E=[];e:for(;;){if(a.length<=l){if(!(t.segnoIndex>=0))break;l=t.segnoIndex}u=a[l++];switch(u.name){case"@":f.push([h,s,u.val]);break;case"n":d=c.t||120,u.len!==null?(m=u.len,g=u.dot||0):(m=c.l,g=u.dot||c.dot),b=60/d*(4/m)*1e3,b*=[1,1.5,1.75,1.875][g]||1,y=c.v<<3;if(c.tie){for(T=f.length;T--;)if(f[T][2]){f.splice(T,1);break}v=t.prevNote}else v=t.prevNote=u.val+(c.o+1)*12,f.push([h,r,v,y,b]);if(m>0){w=c.q/8;if(w<1){S=h+b*w,f.push([S,i,v,y]);for(T=0,N=E.length;T<N;++T)f.push([S,i,E[T],y])}E=[],h+=b;if(!c.tie)break e}else E.push(v);c.tie=!1;break;case"r":d=c.t||120,u.len!==null?(m=u.len,g=u.dot||0):(m=c.l,g=u.dot||c.dot),m>0&&(b=60/d*(4/m)*1e3,b*=[1,1.5,1.75,1.875][g]||1,h+=b);break;case"l":c.l=u.val,c.dot=u.dot;break;case"o":c.o=u.val;break;case"<":c.o<9&&(c.o+=1);break;case">":c.o>0&&(c.o-=1);break;case"v":c.v=u.val;break;case"(":c.v<15&&(c.v+=1);break;case")":c.v>0&&(c.v-=1);break;case"q":c.q=u.val;break;case"&":c.tie=!0;break;case"$":t.segnoIndex=l;break;case"[":p.push([l,null,null]);break;case"|":x=p[p.length-1],x&&x[1]===1&&(p.pop(),l=x[2]);break;case"]":x=p[p.length-1],x&&(x[1]===null&&(x[1]=u.count,x[2]=l),x[1]-=1,x[1]===0?p.pop():l=x[0]);break;case"t":c.t=u.val===null?120:u.val;break;case"EOF":f.push([h,n])}}t.index=l,t.queueTime=h},l=function(e){var t,n,r,i,s,o,u,a,f=new Array(e.length),l=[];for(s=0,o=c.length;s<o;++s){t=c[s],n=t.re;while(r=n.exec(e)){if(!f[r.index]){for(u=0,a=r[0].length;u<a;++u)f[r.index+u]=!0;t.func?i=t.func(r):i={name:r[0]},i&&(i.index=r.index,i.origin=r[0],l.push(i))}while(n.lastIndex<e.length){if(!f[n.lastIndex])break;++n.lastIndex}}}return l.sort(function(e,t){return e.index-t.index}),l.push({name:"EOF"}),l},c=[{re:/@(\d*)/g,func:function(e){return{name:"@",val:e[1]||null}}},{re:/([cdefgab])([\-+]?)(\d*)(\.*)/g,func:function(e){return{name:"n",val:{c:0,d:2,e:4,f:5,g:7,a:9,b:11}[e[1]]+({"-":-1,"+":1}[e[2]]||0),len:e[3]===""?null:Math.min(e[3]|0,64),dot:e[4].length}}},{re:/r(\d*)(\.*)/g,func:function(e){return{name:"r",len:e[1]===""?null:Math.max(1,Math.min(e[1]|0,64)),dot:e[2].length}}},{re:/&/g},{re:/l(\d*)(\.*)/g,func:function(e){return{name:"l",val:e[1]===""?4:Math.min(e[1]|0,64),dot:e[2].length}}},{re:/o([0-9])/g,func:function(e){return{name:"o",val:e[1]===""?4:e[1]|0}}},{re:/[<>]/g},{re:/v(\d*)/g,func:function(e){return{name:"v",val:e[1]===""?12:Math.min(e[1]|0,15)}}},{re:/[()]/g},{re:/q([0-8])/g,func:function(e){return{name:"q",val:e[1]===""?6:Math.min(e[1]|0,8)}}},{re:/\[/g},{re:/\|/g},{re:/\](\d*)/g,func:function(e){return{name:"]",count:e[1]|0||2}}},{re:/t(\d*)/g,func:function(e){return{name:"t",val:e[1]===""?null:Math.max(5,Math.min(e[1]|0,300))}}},{re:/\$/g}];return e}()}(timbre),function(e){function n(t){e.Object.call(this,1,t)}var t=e.fn;t.extend(n),n.prototype.process=function(e){var n=this._;return this.tickID!==e&&(this.tickID=e,n.ar?(t.inputSignalAR(this),t.outputSignalAR(this)):(this.cells[0][0]=t.inputSignalKR(this),t.outputSignalKR(this))),this},t.register("mono",n)}(timbre),function(e){function n(t){e.Object.call(this,2,t)}var t=e.fn;t.extend(n);var r=n.prototype;r.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;var r=this.nodes,i=this.cells[0],s=this.cells[1],o=this.cells[2],u,a=r.length,f,l=i.length,c,h,p;if(n.ar){if(r.length>0){r[0].process(e),h=r[0].cells[1],p=r[0].cells[2],s.set(h),o.set(p);for(u=1;u<a;++u){r[u].process(e),h=r[u].cells[1],p=r[u].cells[2];for(f=0;f<l;++f)s[f]*=h[f],o[f]*=p[f]}}else for(f=0;f<l;++f)s[f]=o[f]=0;t.outputSignalAR(this)}else{if(r.length>0){c=r[0].process(e).cells[0][0];for(u=1;u<a;++u)c*=r[u].process(e).cells[0][0]}else c=0;i[0]=c,t.outputSignalKR(this)}}return this},t.register("*",n)}(timbre),function(e){function n(t){e.Object.call(this,1,t);var n=this._;n.defaultValue=0,n.index=0,n.dict={},n.ar=!1}var t=e.fn;t.extend(n);var r=n.prototype;Object.defineProperties(r,{dict:{set:function(e){if(typeof e=="object")this._.dict=e;else if(typeof e=="function"){var t={};for(var n=0;n<128;++n)t[n]=e(n);this._.dict=t}},get:function(){return this._.dict}},defaultValue:{set:function(e){typeof e=="number"&&(this._.defaultValue=e)},get:function(){return this._.defaultValue}},index:{set:function(e){typeof e=="number"&&(this._.index=e)},get:function(){return this._.index}}}),r.at=function(e){var t=this._;return(t.dict[e|0]||t.defaultValue)*t.mul+t.add},r.clear=function(){return this._.dict={},this},r.process=function(e){var n=this.cells[0],r=this._;if(this.tickID!==e){this.tickID=e;var i=this.nodes.length,s,o,u=r.dict,a=r.defaultValue,f=r.mul,l=r.add,c,h=n.length;if(r.ar&&i){t.inputSignalAR(this);for(c=0;c<h;++c)s=n[c],s<0?s=s-.5|0:s=s+.5|0,n[c]=(u[s]||a)*f+l;t.outputSignalAR(this)}else{s=this.nodes.length?t.inputSignalKR(this):r.index,s<0?s=s-.5|0:s=s+.5|0,o=(u[s]||a)*f+l;for(c=0;c<h;++c)n[c]=o}}return this},t.register("ndict",n)}(timbre),function(e){function n(t){e.Object.call(this,1,t)}var t=e.fn;t.extend(n);var r=n.prototype;r.process=function(e){var t=this.cells[0],n=this._;if(this.tickID!==e){this.tickID=e;var r=n.mul,i=n.add,s,o,u;if(n.ar)for(s=0,o=t.length;s<o;++s)t[s]=(Math.random()*2-1)*r+i;else{u=(Math.random()*2+1)*r+i;for(s=0,o=t.length;s<o;++s)t[s]=u}}return this},t.register("noise",n)}(timbre),function(e){function i(n){e.Object.call(this,2,n);var i=this._;i.freq=e(440),i.phase=e(0),i.osc=new r(i.samplerate),i.tmp=new t.SignalArray(i.cellsize),i.osc.step=i.cellsize,this.once("init",s)}var t=e.fn,n=e.timevalue,r=e.modules.Oscillator;t.extend(i);var s=function(){var e=this._;this.wave||(this.wave="sin"),e.plotData=e.osc.wave,e.plotLineWidth=2,e.plotCyclic=!0,e.plotBefore=u},o=i.prototype;Object.defineProperties(o,{wave:{set:function(e){this._.osc.setWave(e)},get:function(){return this._.osc.wave}},freq:{set:function(t){typeof t=="string"&&(t=n(t),t<=0?t=0:t=1e3/t),this._.freq=e(t)},get:function(){return this._.freq}},phase:{set:function(t){this._.phase=e(t),this._.osc.feedback=!1},get:function(){return this._.phase}},fb:{set:function(t){this._.phase=e(t),this._.osc.feedback=!0},get:function(){return this._.phase}}}),o.clone=function(){var e=t.clone(this);return e._.osc=this._.osc.clone(),e._.freq=this._.freq,e._.phase=this._.phase,e},o.bang=function(){return this._.osc.reset(),this._.emit("bang"),this},o.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;var r=this.cells[1],i=this.cells[2],s,o=n.cellsize;if(this.nodes.length)t.inputSignalAR(this);else for(s=0;s<o;++s)r[s]=i[s]=1;var u=n.osc,a=n.freq.process(e).cells[0],f=n.phase.process(e).cells[0];u.frequency=a[0],u.phase=f[0];if(n.ar){var l=n.tmp;n.freq.isAr?n.phase.isAr?u.processWithFreqAndPhaseArray(l,a,f):u.processWithFreqArray(l,a):n.phase.isAr?u.processWithPhaseArray(l,f):u.process(l);for(s=0;s<o;++s)r[s]*=l[s],i[s]*=l[s]}else{var c=u.next();for(s=0;s<o;++s)r[s]*=c,i[s]*=c}t.outputSignalAR(this)}return this};var u;e.envtype==="browser"&&(u=function(e,t,n,r,i){var s=(i>>1)+.5;e.strokeStyle="#ccc",e.lineWidth=1,e.beginPath(),e.moveTo(t,s+n),e.lineTo(t+r,s+n),e.stroke()}),t.register("osc",i),t.register("sin",function(e){return(new i(e)).set("wave","sin")}),t.register("cos",function(e){return(new i(e)).set("wave","cos")}),t.register("pulse",function(e){return(new i(e)).set("wave","pulse")}),t.register("tri",function(e){return(new i(e)).set("wave","tri")}),t.register("saw",function(e){return(new i(e)).set("wave","saw")}),t.register("fami",function(e){return(new i(e)).set("wave","fami")}),t.register("konami",function(e){return(new i(e)).set("wave","konami")}),t.register("+sin",function(e){return(new i(e)).set("wave","+sin").kr()}),t.register("+pulse",function(e){return(new i(e)).set("wave","+pulse").kr()}),t.register("+tri",function(e){return(new i(e)).set("wave","+tri").kr()}),t.register("+saw",function(e){return(new i(e)).set("wave","+saw").kr()}),t.alias("square","pulse")}(timbre),function(e){function n(n){e.Object.call(this,2,n),t.fixAR(this);var r=this._;r.pos=e(0),r.panL=.5,r.panR=.5}var t=e.fn;t.extend(n);var r=n.prototype;Object.defineProperties(r,{pos:{set:function(t){this._.pos=e(t)},get:function(){return this._.pos}}}),r.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;var r=n.pos.process(e).cells[0][0];if(n.prevPos!==r){var i=r*.5+.5;n.panL=1-r,n.panR=n.prevPos=r}var s=this.nodes,o=this.cells[1],u=this.cells[2],a,f=s.length,l,c=o.length,h;if(f){h=s[0].process(e).cells[0];for(l=0;l<c;++l)o[l]=u[l]=h[l];for(a=1;a<f;++a){h=s[a].process(e).cells[0];for(l=0;l<c;++l)o[l]=u[l]+=h[l]}var p=n.panL,d=n.panR;for(l=0;l<c;++l)o[l]=o[l]*p,u[l]=u[l]*d}else o.set(t.emptycell),u.set(t.emptycell);t.outputSignalAR(this)}return this},t.register("pan",n)}(timbre),function(e){function s(t){e.Object.call(this,2,t);var n=this._;n.value=0,n.env=new i(n.samplerate),n.env.step=n.cellsize,n.curve="lin",n.counter=0,n.ar=!1,n.onended=o(this),this.on("ar",u)}var t=e.fn,n=e.timevalue,r=e.modules.Envelope,i=e.modules.EnvelopeValue;t.extend(s);var o=function(e,t){return function(){if(typeof t=="number"){var n=e.cells[0],r=e.cells[1],i=e.cells[2],s=e._.env.value;for(var o=0,u=r.length;o<u;++o)n[0]=r[o]=i[o]=s}e._.emit("ended")}},u=function(e){this._.env.step=e?1:this._.cellsize},a=s.prototype;Object.defineProperties(a,{value:{set:function(e){typeof e=="number"&&(this._.env.value=e)},get:function(){return this._.env.value}}}),a.to=function(e,t,i){var s=this._,o=s.env;typeof t=="string"?t=n(t):typeof t=="undefined"&&(t=0);if(typeof i=="undefined")s.counter=o.setNext(e,t,r.CurveTypeLin),s.curve="lin";else{var u=r.CurveTypeDict[i];typeof u=="undefined"?s.counter=o.setNext(e,t,r.CurveTypeCurve,i):s.counter=o.setNext(e,t,u),s.curve=i}return s.plotFlush=!0,this},a.setAt=function(e,t){var n=this._;return this.to(n.env.value,t,"set"),n.atValue=e,this},a.linTo=function(e,t){return this.to(e,t,"lin")},a.expTo=function(e,t){return this.to(e,t,"exp")},a.sinTo=function(e,t){return this.to(e,t,"sin")},a.welTo=function(e,t){return this.to(e,t,"wel")},a.sqrTo=function(e,t){return this.to(e,t,"sqr")},a.cubTo=function(e,t){return this.to(e,t,"cub")},a.cancel=function(){var e=this._;return e.counter=e.env.setNext(e.env.value,0,r.CurveTypeSet),this},a.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;var i=this.cells[1],s=this.cells[2],o,u=n.cellsize,a=n.env,f=n.counter,l;if(this.nodes.length)t.inputSignalAR(this);else for(o=0;o<u;++o)i[o]=s[o]=1;f<=0&&(n.curve==="set"?a.setNext(n.atValue,0,r.CurveTypeSet):a.setNext(a.value,0,r.CurveTypeSet),t.nextTick(n.onended),n.counter=Infinity);if(n.ar){for(o=0;o<u;++o)l=a.next(),i[o]*=l,s[o]*=l;n.counter-=n.cellsize}else{l=a.next();for(o=0;o<u;++o)i[o]*=l,s[o]*=l;n.counter-=1}t.outputSignalAR(this),n.value=l}return this};var f=e.Object.prototype.plot;a.plot=function(e){var t=this._;if(t.plotFlush){var n=new i(128),s=new Float32Array(128),o,u,a;if(t.curve==="set")for(u=100,a=s.length;u<a;++u)s[u]=1;else{o=r.CurveTypeDict[t.curve],typeof o=="undefined"?n.setNext(1,1e3,r.CurveTypeCurve,t.curve):n.setNext(1,1e3,o);for(u=0,a=s.length;u<a;++u)s[u]=n.next()}t.plotData=s,t.plotRange=[0,1],t.plotFlush=null}return f.call(this,e)},t.register("param",s)}(timbre),function(e){function r(n){e.Object.call(this,2,n),t.fixAR(this);var r=this._;r.freq=e("sin",{freq:1,add:1e3,mul:250}).kr(),r.Q=e(1),r.allpass=[],this.steps=2}var t=e.fn,n=e.modules.Biquad;t.extend(r);var i=r.prototype;Object.defineProperties(i,{freq:{set:function(e){this._.freq=e},get:function(){return this._.freq}},Q:{set:function(t){this._.Q=e(t)},get:function(){return this._.Q}},steps:{set:function(e){if(typeof e=="number"){e|=0;if(e===2||e===4||e===8||e===12){var t=this._.allpass;if(t.length<e)for(var r=t.length;r<e;++r)t[r]=new n(this._.samplerate),t[r].setType("allpass")}this._.steps=e}},get:function(){return this._.steps}}}),i.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e,t.inputSignalAR(this);if(!n.bypassed){var r=this.cells[1],i=this.cells[2],s=n.freq.process(e).cells[0][0],o=n.Q.process(e).cells[0][0],u=n.steps,a;for(a=0;a<u;a+=2)n.allpass[a].setParams(s,o,0),n.allpass[a].process(r,i),n.allpass[a+1].setParams(s,o,0),n.allpass[a+1].process(r,i)}t.outputSignalAR(this)}return this},t.register("phaser",r)}(timbre),function(e){function r(t){e.Object.call(this,1,t),n.fixAR(this);var r=new Uint8Array(5);for(var i=0;i<5;++i)r[i]=(Math.random()*(1<<30)|0)%25;this._.whites=r,this._.key=0}var t=31,n=e.fn;n.extend(r);var i=r.prototype;i.process=function(e){var n=this.cells[0],r=this._;if(this.tickID!==e){this.tickID=e;var i,s,o,u=r.key,a=r.whites,f=r.mul,l=r.add,c,h,p;for(i=0,s=n.length;i<s;++i){c=u++,u>t&&(u=0),p=c^u;for(o=h=0;o<5;++o)p&1<<o&&(a[o]=(Math.random()*(1<<30)|0)%25),h+=a[o];n[i]=(h*.01666666-1)*f+l}r.key=u}return this},n.register("pink",r)}(timbre),function(e){function n(t){e.Object.call(this,1,t),this._.freq=440,this._.buffer=null,this._.index=0}var t=e.fn;t.extend(n);var r=n.prototype;Object.defineProperties(r,{freq:{set:function(e){typeof e=="number"&&(e<0&&(e=0),this._.freq=e)},get:function(){return this._.freq}}}),r.bang=function(){var e=this._,n=e.freq,r=e.samplerate/n+.5|0,i=e.buffer=new t.SignalArray(r);for(var s=0;s<r;++s)i[s]=Math.random()*2-1;return e.index=0,e.emit("bang"),this},r.process=function(e){var t=this.cells[0],n=this._;if(this.tickID!==e){this.tickID=e;var r=n.buffer;if(r){var i=r.length,s=n.index,o,u=n.mul,a=n.add,f,l,c=t.length;for(l=0;l<c;++l)o=s,f=r[s++],s>=i&&(s=0),f=(f+r[s])*.5,r[o]=f,t[l]=f*u+a;n.index=s}}return this},t.register("pluck",n)}(timbre),function(e){function s(n){e.Object.call(this,1,n),t.listener(this),t.fixAR(this);var i=this._;i.timeout=5e3,i.status=r,i.writeIndex=0,i.writeIndexIncr=1,i.currentTime=0,i.currentTimeIncr=1e3/i.samplerate,i.onended=o(this)}var t=e.fn,n=e.timevalue,r=0,i=1;t.extend(s);var o=function(e){return function(){var n=e._,i=new t.SignalArray(n.buffer.subarray(0,n.writeIndex|0));n.status=r,n.writeIndex=0,n.currentTime=0,n.emit("ended",{buffer:i,samplerate:n.samplerate})}},u=s.prototype;Object.defineProperties(u,{timeout:{set:function(e){typeof e=="string"&&(e=n(e)),typeof e=="number"&&e>0&&(this._.timeout=e)},get:function(){return this._.timeout}},samplerate:{set:function(e){typeof e=="number"&&0<e&&e<=this._.samplerate&&(this._.samplerate=e)},get:function(){return this._.samplerate}},currentTime:{get:function(){return this._.currentTime}}}),u.start=function(){var n=this._,s;if(n.status===r){s=n.timeout*.01*n.samplerate|0;if(!n.buffer||n.buffer.length<s)n.buffer=new t.SignalArray(s);n.writeIndex=0,n.writeIndexIncr=n.samplerate/e.samplerate,n.currentTime=0,n.status=i,n.emit("start"),this.listen()}return this},u.stop=function(){var e=this._;return e.status===i&&(e.status=r,e.emit("stop"),t.nextTick(e.onended),this.unlisten()),this},u.bang=function(){return this._.status===r?this.srart():this._.status===i&&this.stop(),this._.emit("bang"),this},u.process=function(e){var n=this._,r=this.cells[0];if(this.tickID!==e){this.tickID=e,t.inputSignalAR(this);if(n.status===i){var s,o=r.length,u=n.buffer,a=n.timeout,f=n.writeIndex,l=n.writeIndexIncr,c=n.currentTime,h=n.currentTimeIncr;for(s=0;s<o;++s)u[f|0]=r[s],f+=l,c+=h,a<=c&&t.nextTick(n.onended);n.writeIndex=f,n.currentTime=c}t.outputSignalAR(this)}return this},t.register("record",s),t.alias("rec","record")}(timbre),function(e){function r(r){e.Object.call(this,2,r),t.fixAR(this),this._.reverb=new n(this._.samplerate,this._.cellsize)}var t=e.fn,n=e.modules.Reverb;t.extend(r);var i=r.prototype;Object.defineProperties(i,{room:{set:function(e){typeof e=="number"&&(e=e>1?1:e<0?0:e,this._.reverb.setRoomSize(e))},get:function(){return this._.reverb.roomsize}},damp:{set:function(e){typeof e=="number"&&(e=e>1?1:e<0?0:e,this._.reverb.setDamp(e))},get:function(){return this._.reverb.damp}},mix:{set:function(e){typeof e=="number"&&(e=e>1?1:e<0?0:e,this._.reverb.wet=e)},get:function(){return this._.reverb.wet}}}),i.process=function(e){var n=this._;return this.tickID!==e&&(this.tickID=e,t.inputSignalAR(this),n.bypassed||n.reverb.process(this.cells[1],this.cells[2]),t.outputSignalAR(this)),this},t.register("reverb",r)}(timbre),function(e){function r(n){e.Object.call(this,0,n),t.timer(this),t.fixKR(this);var r=this._;r.queue=[],r.currentTime=0,r.maxRemain=1e3}var t=e.fn,n=e.timevalue;t.extend(r);var i=r.prototype;Object.defineProperties(i,{queue:{get:function(){return this._.queue}},remain:{get:function(){return this._.queue.length}},maxRemain:{set:function(e){typeof e=="number"&&e>0&&(this._.maxRemain=e)},get:function(){return this._.maxRemain}},isEmpty:{get:function(){return this._.queue.length===0}},currentTime:{get:function(){return this._.currentTime}}}),i.sched=function(e,t,r){return typeof e=="string"&&(e=n(e)),typeof e=="number"&&this.schedAbs(this._.currentTime+e,t,r),this},i.schedAbs=function(t,r,i){typeof t=="string"&&(t=n(t));if(typeof t=="number"){var s=this._,o=s.queue;if(o.length>=s.maxRemain)return this;for(var u=o.length;u--;)if(o[u][0]<t)break;o.splice(u+1,0,[t,e(r),i])}return this},i.advance=function(e){return typeof e=="string"&&(e=n(e)),typeof e=="number"&&(this._.currentTime+=e),this},i.clear=function(){return this._.queue.splice(0),this},i.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;var r=null,i=n.queue;if(i.length)while(i[0][0]<n.currentTime){var s=n.queue.shift();s[1].bang(s[2]),r="sched";if(i.length===0){r="empty";break}}n.currentTime+=t.currentTimeIncr,r&&n.emit(r)}return this},t.register("schedule",r),t.alias("sched","schedule")}(timbre),function(e){function r(n){e.Object.call(this,2,n),t.listener(this),t.fixAR(this);var r=this._;r.samples=0,r.writeIndex=0,r.plotFlush=!0,this.once("init",i)}var t=e.fn,n=e.timevalue;t.extend(r);var i=function(){this._.buffer||(this.size=1024),this._.interval||(this.interval=1e3)},s=r.prototype;Object.defineProperties(s,{size:{set:function(e){var n=this._;if(!n.buffer&&typeof e=="number"){var r=e<64?64:e>2048?2048:e;n.buffer=new t.SignalArray(r),n.reservedinterval&&(this.interval=n.reservedinterval,n.reservedinterval=null)}},get:function(){return this._.buffer.length}},interval:{set:function(e){var t=this._;typeof e=="string"&&(e=n(e)),typeof e=="number"&&e>0&&(t.buffer?(t.interval=e,t.samplesIncr=e*.001*t.samplerate/t.buffer.length,t.samplesIncr<1&&(t.samplesIncr=1)):t.reservedinterval=e)},get:function(){return this._.interval}}}),s.bang=function(){var e=this._,t=e.buffer;for(var n=0,r=t.length;n<r;++n)t[n]=0;return e.samples=0,e.writeIndex=0,this._.emit("bang"),this},s.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e,t.inputSignalAR(this),t.outputSignalAR(this);var r=this.cells[0],i,s=n.cellsize,o=n.samples,u=n.samplesIncr,a=n.buffer,f=n.writeIndex,l=!1,c=a.length;for(i=0;i<s;++i)o<=0&&(a[f++]=r[i],f>=c&&(f=0),l=n.plotFlush=!0,o+=u),--o;n.samples=o,n.writeIndex=f,l&&this._.emit("data")}return this};var o=e.Object.prototype.plot;s.plot=function(e){var t=this._;if(t.plotFlush){var n=t.buffer,r=n.length-1,i=new Float32Array(n.length),s=t.writeIndex;for(var u=0,a=n.length;u<a;u++)i[u]=n[++s&r];t.plotData=i,t.plotFlush=null}return o.call(this,e)},t.register("scope",r)}(timbre),function(e){function n(n){e.Object.call(this,2,n),t.fixAR(this);var i=this._;i.numberOfInputs=0,i.numberOfOutputs=0,i.bufferSize=0,i.bufferMask=0,i.duration=0,i.inputBufferL=null,i.inputBufferR=null,i.outputBufferL=null,i.outputBufferR=null,i.onaudioprocess=null,i.index=0,this.once("init",r)}function s(e,t){this.samplerate=e._.samplerate,this.length=e._.bufferSize,this.duration=e._.duration,this.numberOfChannels=t.length,this.getChannelData=function(e){return t[e]}}function o(t){var n=t._;this.node=t,this.playbackTime=e.currentTime,n.numberOfInputs===2?this.inputBuffer=new s(t,[n.inputBufferL,n.inputBufferR]):this.inputBuffer=new s(t,[n.inputBufferL]),n.numberOfOutputs===2?this.outputBuffer=new s(t,[n.outputBufferL,n.outputBufferR]):this.outputBuffer=new s(t,[n.outputBufferL])}var t=e.fn;t.extend(n);var r=function(){var e=this._;e.numberOfInputs===0&&(this.numberOfInputs=1),e.numberOfOutputs===0&&(this.numberOfOutputs=1),e.bufferSize===0&&(this.bufferSize=1024)},i=n.prototype;Object.defineProperties(i,{numberOfInputs:{set:function(e){var t=this._;t.numberOfInputs===0&&(t.numberOfInputs=e===2?2:1)},get:function(){return this._.numberOfInputs}},numberOfOutputs:{set:function(e){var t=this._;t.numberOfOutputs===0&&(t.numberOfOutputs=e===2?2:1)},get:function(){return this._.numberOfOutputs}},bufferSize:{set:function(e){var n=this._;n.bufferSize===0&&[256,512,1024,2048,4096,8192,16384].indexOf(e)!==-1&&(n.bufferSize=e,n.bufferMask=e-1,n.duration=e/n.samplerate,n.inputBufferL=new t.SignalArray(e),n.inputBufferR=new t.SignalArray(e),n.outputBufferL=new t.SignalArray(e),n.outputBufferR=new t.SignalArray(e))},get:function(){return this._.bufferSize}},onaudioprocess:{set:function(e){typeof e=="function"&&(this._.onaudioprocess=e)},get:function(){return this._.onaudioprocess}}}),i.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;var r=n.cellsize,i=n.bufferMask,s=n.index,u=s+r,a,f=this.cells[1],l=this.cells[2];t.inputSignalAR(this);if(n.numberOfInputs===2)n.inputBufferL.set(f,s),n.inputBufferR.set(l,s);else{a=n.inputBufferL;for(var c=0;c<r;c++)a[s+c]=(f[c]+l[c])*.5}f.set(n.outputBufferL.subarray(s,u)),l.set(n.outputBufferR.subarray(s,u)),n.index=u&i,n.index===0&&n.onaudioprocess&&(n.onaudioprocess(new o(this)),n.numberOfOutputs===1&&n.outputBufferR.set(n.outputBufferL)),t.outputSignalAR(this)}return this},t.register("script",n)}(timbre),function(e){function n(t){e.Object.call(this,2,t),this._.selected=0,this._.background=!1}var t=e.fn;t.extend(n);var r=n.prototype;Object.defineProperties(r,{selected:{set:function(e){typeof e=="number"&&(this._.selected=e,this.cells[1].set(t.emptycell),this.cells[2].set(t.emptycell))},get:function(){return this._.selected}},background:{set:function(e){this._.background=!!e},get:function(){return this._.background}}}),r.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;var r=this.nodes,i,s=r.length;if(n.background)for(i=0;i<s;++i)r[i].process(e);var o=r[n.selected];o&&(n.background||o.process(e),this.cells[1].set(o.cells[1]),this.cells[2].set(o.cells[2])),t.outputSignalAR(this)}return this},t.register("selector",n)}(timbre),function(e){function o(n){e.Object.call(this,2,n),t.listener(this),t.fixAR(this);var r=this._;r.status=i,r.samples=0,r.samplesIncr=0,r.writeIndex=0,r.plotFlush=!0,r.plotRange=[0,32],r.plotBarStyle=!0,this.once("init",u)}var t=e.fn,n=e.timevalue,r=e.modules.FFT,i=0,s=1;t.extend(o);var u=function(){var e=this._;e.fft||(this.size=512),e.interval||(this.interval=500)},a=o.prototype;Object.defineProperties(a,{size:{set:function(e){var n=this._;if(!n.fft&&typeof e=="number"){var i=e<256?256:e>2048?2048:e;n.fft=new r(i),n.buffer=new t.SignalArray(n.fft.length),n.freqs=new t.SignalArray(n.fft.length>>1),n.reservedwindow&&(n.fft.setWindow(n.reservedwindow),n.reservedwindow=null),n.reservedinterval&&(this.interval=n.reservedinterval,n.reservedinterval=null)}},get:function(){return this._.buffer.length}},window:{set:function(e){this._.fft.setWindow(e)},get:function(){return this._.fft.windowName}},interval:{set:function(e){var t=this._;typeof e=="string"&&(e=n(e)),typeof e=="number"&&e>0&&(t.buffer?(t.interval=e,t.samplesIncr=e*.001*t.samplerate,t.samplesIncr<t.buffer.length&&(t.samplesIncr=t.buffer.length,t.interval=t.samplesIncr*1e3/t.samplerate)):t.reservedinterval=e)},get:function(){return this._.interval}},spectrum:{get:function(){return this._.fft.getFrequencyData(this._.freqs)}},real:{get:function(){return this._.fft.real}},imag:{get:function(){return this._.fft.imag}}}),a.bang=function(){return this._.samples=0,this._.writeIndex=0,this._.emit("bang"),this},a.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e,t.inputSignalAR(this),t.outputSignalAR(this);var r=this.cells[0],o,u=r.length,a=n.status,f=n.samples,l=n.samplesIncr,c=n.writeIndex,h=n.buffer,p=h.length,d;for(o=0;o<u;++o)f<=0&&a===i&&(a=s,c=0,f+=l),a===s&&(h[c++]=r[o],p<=c&&(n.fft.forward(h),d=n.plotFlush=!0,a=i)),--f;n.samples=f,n.status=a,n.writeIndex=c,d&&this._.emit("data")}return this};var f=e.Object.prototype.plot;a.plot=function(e){return this._.plotFlush&&(this._.plotData=this.spectrum,this._.plotFlush=null),f.call(this,e)},t.register("spectrum",o)}(timbre),function(e){function n(t){e.Object.call(this,2,t),this._.ar=!1}var t=e.fn;t.extend(n);var r=n.prototype;r.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;var r=this.nodes,i=this.cells[0],s=this.cells[1],o=this.cells[2],u,a=r.length,f,l=i.length,c,h,p;if(n.ar){if(r.length>0){r[0].process(e),h=r[0].cells[1],p=r[0].cells[2],s.set(h),o.set(p);for(u=1;u<a;++u){r[u].process(e),h=r[u].cells[1],p=r[u].cells[2];for(f=0;f<l;++f)s[f]-=h[f],o[f]-=p[f]}}else for(f=0;f<l;++f)s[f]=o[u]=0;t.outputSignalAR(this)}else{if(r.length>0){c=r[0].process(e).cells[0][0];for(u=1;u<a;++u)c-=r[u].process(e).cells[0][0]}else c=0;i[0]=c,t.outputSignalKR(this)}}return this},t.register("-",n)}(timbre),function(e){function n(n){e.Object.call(this,2,n),t.fixAR(this);var r=this._;this.playbackState=t.FINISHED_STATE,r.poly=4,r.genList=[],r.genDict={},r.synthdef=null,r.remGen=s(this),r.onended=t.make_onended(this)}var t=e.fn;t.extend(n);var r=n.prototype;Object.defineProperties(r,{def:{set:function(e){typeof e=="function"&&(this._.synthdef=e)},get:function(){return this._.synthdef}},poly:{set:function(e){typeof e=="number"&&0<e&&e<=64&&(this._.poly=e)},get:function(){return this._.poly}}});var i=function(e,t){return function(){e._.remGen(t.gen)}},s=function(e){return function(t){var n=e._,r=n.genList.indexOf(t);r!==-1&&n.genList.splice(r,1),typeof t.noteNum!="undefined"&&(n.genDict[t.noteNum]=null)}},o=function(n,r,s,o){s|=0,s<=0?this.noteOff(this,n):s>127&&(s=127);var u=this._,a=u.genList,f=u.genDict,l=f[n];l&&u.remGen(l);var c={freq:r,noteNum:n,velocity:s,mul:s*.0078125};if(o)for(var h in o)c[h]=o[h];c.doneAction=i(this,c),l=u.synthdef.call(this,c),l instanceof e.Object&&(l.noteNum=n,a.push(l),f[n]=c.gen=l,this.playbackState=t.PLAYING_STATE,a.length>u.poly&&u.remGen(a[0]))},u=function(){var e=new Float32Array(128);for(var t=0;t<128;++t)e[t]=440*Math.pow(2,(t-69)*1/12);return e}(),a=function(e){return e>0?Math.log(e*1/440)*Math.LOG2E*12+69:0};r.noteOn=function(e,t,n){var r=u[e]||440*Math.pow(2,(e-69)/12);return o.call(this,e+.5|0,r,t,n),this},r.noteOff=function(e){var t=this._.genDict[e];return t&&t.release&&t.release(),this},r.noteOnWithFreq=function(e,t,n){var r=a(e);return o.call(this,r+.5|0,e,t,n),this},r.noteOffWithFreq=function(e){var t=a(e);return this.noteOff(t+.5|0)},r.allNoteOff=function(){var e=this._.genList;for(var t=0,n=e.length;t<n;++t)e[t].release&&e[t].release()},r.allSoundOff=function(){var e=this._,t=e.genList,n=e.genDict;while(t.length)delete n[t.shift().noteNum]},r.synth=function(n){var r=this._,s=r.genList,o,u={};if(n)for(var a in n)u[a]=n[a];return u.doneAction=i(this,u),o=r.synthdef.call(this,u),o instanceof e.Object&&(s.push(o),u.gen=o,this.playbackState=t.PLAYING_STATE,s.length>r.poly&&r.remGen(s[0])),this},r.process=function(e){var n=this.cells[0],r=this._;if(this.tickID!==e){this.tickID=e;if(this.playbackState===t.PLAYING_STATE){var i=r.genList,s,o=this.cells[1],u=this.cells[2],a,f,l,c=n.length,h,p;if(i.length){s=i[0],s.process(e),o.set(s.cells[1]),u.set(s.cells[2]);for(a=1,f=i.length;a<f;++a){s=i[a],s.process(e),h=s.cells[1],p=s.cells[2];for(l=0;l<c;++l)o[l]+=h[l],u[l]+=p[l]}}else t.nextTick(r.onended)}t.outputSignalAR(this)}return this},t.register("SynthDef",n);var f={set:function(n){t.isDictionary(n)?typeof n.type=="string"&&(this._.env=n):n instanceof e.Object&&(this._.env=n)},get:function(){return this._.env}};t.register("OscGen",function(){var t={set:function(t){t instanceof e.Object&&(this._.osc=t)},get:function(){return this._.osc}},r={set:function(e){typeof e=="string"&&(this._.wave=e)},get:function(){return this._.wave}},i=function(t){var n=this._,r,i,s,o;return i=n.osc||null,s=n.env||{},o=s.type||"perc",i instanceof e.Object&&typeof i.clone=="function"&&(i=i.clone()),i||(i=e("osc",{wave:n.wave})),i.freq=t.freq,i.mul=i.mul*t.velocity/128,r=i,s instanceof e.Object?typeof s.clone=="function"&&(r=s.clone().append(r)):r=e(o,s,r),r.on("ended",t.doneAction).bang(),r};return function(e){var s=new n(e);return s._.wave="sin",Object.defineProperties(s,{env:f,osc:t,wave:r}),s.def=i,s}}()),t.register("PluckGen",function(){var t=function(t){var n=this._,r,i,s;return i=n.env||{},s=i.type||"perc",r=e("pluck",{freq:t.freq,mul:t.velocity/128}).bang(),i instanceof e.Object?typeof i.clone=="function"&&(r=i.clone().append(r)):r=e(s,i,r),r.on("ended",t.doneAction).bang(),r};return function(e){var r=new n(e);return Object.defineProperties(r,{env:f}),r.def=t,r}}())}(timbre),function(e){function o(n){e.Object.call(this,2,n),t.fixAR(this);var r=this._;r.isLooped=!1,r.onended=t.make_onended(this,0)}var t=e.fn,n=e.modules.Scissor,r=n.Tape,i=n.TapeStream,s=t.isSignalArray;t.extend(o);var u=o.prototype;Object.defineProperties(u,{tape:{set:function(o){o instanceof r?(this.playbackState=t.PLAYING_STATE,this._.tape=o,this._.tapeStream=new i(o,this._.samplerate),this._.tapeStream.isLooped=this._.isLooped):(o instanceof e.Object&&o.buffer&&(o=o.buffer),typeof o=="object"&&Array.isArray(o.buffer)&&s(o.buffer[0])&&(this.playbackState=t.PLAYING_STATE,this._.tape=new n(o),this._.tapeStream=new i(this._.tape,this._.samplerate),this._.tapeStream.isLooped=this._.isLooped))},get:function(){return this._.tape}},isLooped:{get:function(){return this._.isLooped}},buffer:{get:function(){if(this._.tape)return this._.tape.getBuffer()}}}),u.loop=function(e){return this._.isLooped=!!e,this._.tapeStream&&(this._.tapeStream.isLooped=this._.isLooped),this},u.bang=function(){return this.playbackState=t.PLAYING_STATE,this._.tapeStream&&this._.tapeStream.reset(),this._.emit("bang"),this},u.getBuffer=function(){if(this._.tape)return this._.tape.getBuffer()},u.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e;var r=n.tapeStream;if(r){var i=this.cells[1],s=this.cells[2],o=r.fetch(i.length);i.set(o[0]),s.set(o[1]),this.playbackState===t.PLAYING_STATE&&r.isEnded&&t.nextTick(n.onended)}t.outputSignalAR(this)}return this},t.register("tape",o)}(timbre),function(e){function i(n){e.Object.call(this,1,n),t.timer(this);var r=this._;this.playbackState=t.FINISHED_STATE,r.task=[],r.i=0,r.j=0,r.imax=0,r.jmax=0,r.wait=0,r.count=0,r.args={},r.doNum=1,r.initFunc=t.nop,r.onended=o(this),this.on("start",s)}var t=e.fn,n=e.timevalue,r=e(function(){}).constructor;t.extend(i);var s=function(){var e=this._,n;this.playbackState=t.PLAYING_STATE,e.task=this.nodes.map(function(e){return e instanceof r?e.func:!1}).filter(function(e){return!!e}),e.i=e.j=0,e.imax=e.doNum,e.jmax=e.task.length,n=e.initFunc(),t.isDictionary(n)||(n={param:n}),e.args=n},o=function(e){return function(){e.playbackState=t.FINISHED_STATE;var n=e._,r=e.cells[0],i=e.cells[1],s=e.cells[2],o=n.args;if(typeof o=="number")for(var u=0,a=i.length;u<a;++u)r[0]=i[u]=s[u]=o;n.emit("ended",n.args)}},u=i.prototype;Object.defineProperties(u,{"do":{set:function(e){typeof e=="number"&&e>0&&(this._.doNum=e===Infinity?Infinity:e|0)},get:function(){return this._.doNum}},init:{set:function(e){typeof e=="function"&&(this._.initFunc=e)},get:function(){return this._.initFunc}}}),u.bang=function(){var e=this._;return e.count=0,e.emit("bang"),this},u.wait=function(e){return typeof e=="string"&&(e=n(e)),typeof e=="number"&&e>0&&(this._.count+=this._.samplerate*e*.001|0),this},u.process=function(e){var n=this.cells[0],r=this._,i,s;if(this.tickID!==e){this.tickID=e;if(r.i<r.imax){while(r.count<=0){if(r.j>=r.jmax){++r.i;if(r.i>=r.imax){t.nextTick(r.onended);break}r.j=0}s=r.task[r.j++],s&&s.call(this,r.i,r.args)}r.count-=n.length}}return this},t.register("task",i)}(timbre),function(e){function r(n){e.Object.call(this,0,n),t.timer(this),t.fixKR(this);var r=this._;this.playbackState=t.FINISHED_STATE,r.currentTime=0,r.samplesMax=0,r.samples=0,r.onended=t.make_onended(this),this.once("init",i),this.on("start",s)}var t=e.fn,n=e.timevalue;t.extend(r);var i=function(){this._.timeout||(this.timeout=1e3)},s=function(){this.playbackState=t.PLAYING_STATE};Object.defineProperty(s,"unremovable",{value:!0,writable:!1});var o=r.prototype;Object.defineProperties(o,{timeout:{set:function(e){var r=this._;typeof e=="string"&&(e=n(e)),typeof e=="number"&&e>=0&&(this.playbackState=t.PLAYING_STATE,r.timeout=e,r.samplesMax=r.samplerate*e*.001|0,r.samples=r.samplesMax)},get:function(){return this._.timeout}},currentTime:{get:function(){return this._.currentTime}}}),o.bang=function(){var e=this._;return this.playbackState=t.PLAYING_STATE,e.samples=e.samplesMax,e.currentTime=0,e.emit("bang"),this},o.process=function(e){var n=this.cells[0],r=this._;if(this.tickID!==e){this.tickID=e,r.samples>0&&(r.samples-=n.length);if(r.samples<=0){var i=this.nodes;for(var s=0,o=i.length;s<o;++s)i[s].bang();t.nextTick(r.onended)}r.currentTime+=t.currentTimeIncr}return this},t.register("timeout",r)}(timbre),function(e){function n(n){e.Object.call(this,1,n),t.fixAR(this),this._.curve=null}var t=e.fn;t.extend(n);var r=n.prototype;Object.defineProperties(r,{curve:{set:function(e){t.isSignalArray(e)&&(this._.curve=e)},get:function(){return this._.curve}}}),r.process=function(e){var n=this._;if(this.tickID!==e){this.tickID=e,t.inputSignalAR(this);if(n.curve){var r=this.cells[0],i=n.curve,s=i.length,o,u,a=n.cellsize;for(u=0;u<a;++u)o=(r[u]+1)*.5*s+.5|0,o<0?o=0:o>=s-1&&(o=s-1),r[u]=i[o]}t.outputSignalAR(this)}return this},t.register("waveshaper",n)}(timbre),function(e){function n(t){e.Object.call(this,1,t);var n=this._;n.inMin=0,n.inMax=1,n.outMin=0,n.outMax=1,n.ar=!1,this.once("init",r)}var t=e.fn;t.extend(n);var r=function(){this._.warp||(this.warp="linlin")},i=n.prototype;Object.defineProperties(i,{inMin:{set:function(e){typeof e=="number"&&(this._.inMin=e)},get:function(){return this._.inMin}},inMax:{set:function(e){typeof e=="number"&&(this._.inMax=e)},get:function(){return this._.inMax}},outMin:{set:function(e){typeof e=="number"&&(this._.outMin=e)},get:function(){return this._.outMin}},outMax:{set:function(e){typeof e=="number"&&(this._.outMax=e)},get:function(){return this._.outMax}},warp:{set:function(e){if(typeof e=="string"){var t=s[e];t&&(this._.warp=t,this._.warpName=e)}},get:function(){return this._.warpName}}}),i.process=function(e){var n=this._,r=this.cells[0];if(this.tickID!==e){this.tickID=e;var i=n.inMin,s=n.inMax,o=n.outMin,u=n.outMax,a=n.warp,f=this.nodes.length,l=n.mul,c=n.add,h,p=r.length;if(n.ar&&f){t.inputSignalAR(this);for(h=0;h<p;++h)r[h]=a(r[h],i,s,o,u)*l+c;t.outputSignalAR(this)}else{var d=this.nodes.length?t.inputSignalKR(this):0,v=a(d,i,s,o,u)*l+c;for(h=0;h<p;++h)r[h]=v}}return this};var s={linlin:function(e,t,n,r,i){return e<t?r:e>n?i:n===t?r:(e-t)/(n-t)*(i-r)+r},linexp:function(e,t,n,r,i){return e<t?r:e>n?i:r===0?0:n===t?i:Math.pow(i/r,(e-t)/(n-t))*r},explin:function(e,t,n,r,i){return e<t?r:e>n?i:t===0?i:Math.log(e/t)/Math.log(n/t)*(i-r)+r},expexp:function(e,t,n,r,i){return e<t?r:e>n?i:t===0||r===0?0:Math.pow(i/r,Math.log(e/t)/Math.log(n/t))*r}};t.register("zmap",n)}(timbre);